{
  "ProjectName": "wpfpatterns",
  "Title": "WPF Architectural Patterns Examples",
  "Description": "Some sample code demonstrating how various GUI architectural patterns can be implementing in WPF.",
  "MovedLink": "",
  "HomeWiki": "<div class=\"wikidoc\"><b>Project Description</b><br />Some sample code demonstrating how various GUI architectural patterns can be implementing in WPF.<br /><br />These patterns include:\n<ul><li>Autonomous View</li>\n<li>Passive View</li>\n<li>Supervising Controller</li>\n<li>MVVM/ViewModel/Presentation Model</li></ul>\n<br />In case you are wondering, Model-View-Presenter is covered in the list. Supervising Controller and Passive View are two flavors of MVP.<br /><br />Be sure to check out <a href=\"http://caliburn.codeplex.com\">http://caliburn.codeplex.com</a> for an excellent WPF/Silverlight framework.<br /><br /><div class=\"rss\"><div class=\"accentbar\"><span class=\"left\">&nbsp;</span>Christopher Bennage News Feed<span class=\"right\">&nbsp;</span></div><div class=\"entry\"><div class=\"title\"><a href=\"http://feedproxy.google.com/~r/ChristopherBennage/~3/cF-H0RtKz8s/\">Couple of JavaScript Questions</a></div><div class=\"moreinfo\"><span class=\"date\">Monday, May 20, 2013</span> &nbsp;|&nbsp; <span class=\"source\">From <a target=\"_blank\" href=\"http://feeds.feedburner.com/ChristopherBennage\">Christopher Bennage</a></span></div><p><p>A <a href=\"https://twitter.com/juliandominguez\">friend</a> was reviewing the <a href=\"http://dev.bennage.com/blog/2013/03/05/game-dev-03/\">last post</a> and he asked two questions about this JavaScript snippet:</p><br /><br /><pre><code>var entityIndex = entities.length - 1;\nfor (; entityIndex != 0; entityIndex--) {\n    entities[entityIndex].draw(ctx);\n}\n</code></pre><br />\n<ul><br /><li>Why am I initializing <code>entityIndex</code> outside the loop?</li>\n<li>Why do I compare <code>entityIndex</code> to 0?</li>\n</ul>\n<br />\n<h2>Initializing Outside</h2><br /><br /><p>The answer to the first question is really just personal readability (well, perhaps a <em>small</em> touch of &#8220;this will make people pause and think&#8221;).</p><br /><br /><p>Let&#8217;s dig into the construct a bit though.The declaration of <code>for</code> loop consists of three expressions. (I&#8217;m not talking about <code>for(in)</code> here.)</p><br /><br /><p>The first expression is an initializer; it is executed just once. It is usually something like <code>var i = 0</code>. This expression is still subject to <a href=\"https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Statements/var#var_hoisting\">hoisting</a>.</p><br /><br /><p>The second expression is a conditional. It&#8217;s executed <em>at least</em> once.</p><br /><br /><p>The third expresion modifies the state and is executed once each time the condition is true. (No big surprises here.)</p><br /><br /><p>In the case above, I instinctly felt there was too much going on one line, so I moved the first expression outside of the <code>for</code>. This does really have any impact on the way the code is executed and (since the variable is hoisted) is actually a bit closer to what the interpreter is really doing.</p><br />\n<h2>Comparing to Zero</h2><br /><br /><p>I choose to use <code>entityIndex != 0</code> not because I wanted to compare to zero, but because I wanted to avoid the cost of evaluating <code>entities.length</code> repeatedly. Since the second expression is evaluated over and over, we don&#8217;t want to do anything expensive there. If our <code>entities</code> had lots of members, then calculating <code>length</code> could have a significant impact.</p><br /><br /><p>There is some question about the relative performance of <code>&gt; 0</code> vs <code>!= 0</code>, however the <a href=\"http://jsperf.com/greater-than-zero-vs-not-zero/2\">test results</a> for that seem to indicate that it is not consequential.</p><br />\n<h2>Closing Thoughts</h2><br />\n<ul><br /><li>It&#8217;s easy to obsess about optmizations, but it&#8217;s important to understand than many micro-optimizations are browser-specific. So test, test, test before you waste time on it.</li>\n<li>I made the one change because it was more readable <em>to me</em>. It might not be so to you. If so, don&#8217;t do it.</li>\n</ul>\n<br />\n<h2>References</h2><br />\n<ul><br /><li><a href=\"http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf\">Ecma 262 Standard</a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Statements/var#var_hoisting\">var hoisting</a></li>\n<li><a href=\"http://jsperf.com/greater-than-zero-vs-not-zero/2\">greater than vs not equal</a></li>\n<li><a href=\"http://jsperf.com/comparison-zero-vs-number/2\">compare zero vs number</a></li>\n</ul><img src=\"http://feeds.feedburner.com/~r/ChristopherBennage/~4/cF-H0RtKz8s\" height=\"1\" width=\"1\"/></p></div><div class=\"entry\"><div class=\"title\"><a href=\"http://feedproxy.google.com/~r/ChristopherBennage/~3/p3hLlTS9YSc/\">Building a Game with JavaScript: Making Things Move</a></div><div class=\"moreinfo\"><span class=\"date\">Tuesday, March 05, 2013</span> &nbsp;|&nbsp; <span class=\"source\">From <a target=\"_blank\" href=\"http://feeds.feedburner.com/ChristopherBennage\">Christopher Bennage</a></span></div><p><p>This is a continuation from the <a href=\"http://dev.bennage.com/blog/2013/01/11/game-dev-02/\">previous post</a>.</p><br />\n<h2>Setting The Stage</h2><br /><br /><p>The game we&#8217;re building will have waves of enemy ships fly in to attack the player&#8217;s units. Let&#8217;s begin by making a simple enemy as well as some dummy targets for them to attack. I&#8217;m going to keep the graphics very simple for the moment. Likewise we are going to focus on the enemy behavior and not worry about any player interaction just yet.</p><br /><br /><p><img class=\"right\" src=\"http://dev.bennage.com/images/posts/game-dev-move-01.png\" title=\"[little, yellow, different]\" ></p><br /><br /><p>Here&#8217;s a <a href=\"http://jsfiddle.net/bennage/HqYeD/18/\">demo</a> of what we&#8217;ll make. Click on the start screen to transition into the game. The little yellow rectangles are our enemy ships. Each one projects its own target as a little red circle. Once it touches its target, it projects a new one and then flies toward it.</p><br /><br /><p>Let&#8217;s start from the top down. Our enemy units will &#8220;live&#8221; in our main screen for the game. (At least for the time being.) This screen needs to expose the same interface that we had for the start screen we made in the last post. We&#8217;ll also add a <code>start</code> method that we&#8217;ll call just once in order to initialize things.</p><br />\n<h3>Implementation</h3><br /><br /><p>Here&#8217;s the implementation:</p><br /><br /><script src=\"https://gist.github.com/5078744.js\"></script><br /><br />\n<h3>Explanation</h3><br /><br /><p>The <code>entities</code> array will contain a list of the enemies we&#8217;re tracking. I used the name &#8220;entity&#8221; because this is a common term in game development. In general, it means something that has behavior and is drawn to the screen. Thus, you can expect entities to have <code>update</code> and <code>draw</code> methods. This is not a hard and fast definition though. You&#8217;ll find that the specifics of the definition can vary among engines, frameworks, and developers.</p><br /><br /><p>In our <code>start</code> function we populate <code>entities</code> by invoking our (as yet undefined) <code>makeEnemyShip</code> function. I&#8217;m passing in two numbers that <code>makeEnemyShip</code> will use to set the x and y position of the ship. I could have used random numbers or even hard coded values, however deriving from the loop&#8217;s controls makes it easy to cluster all the ships in the upper left corner of the screen.</p><br /><br /><p>The <code>draw</code> and <code>update</code> functions for the screen are very similar. They both iterate over <code>entities</code> and invoke the corresponding function on each entity. They also pass along the necessary context. For <code>draw</code>, this is the 2D drawing context of the canvas and for <code>update</code> it&#8217;s the elapsed time since the last frame.</p><br /><br /><p>Notice how the loop is structured differently from the loop in <code>start</code>. This is a performance optimization; though it has little consequence with so small an array. On some browsers, the call to <code>length</code> is a bit expensive. (Especially in cases when the array isn&#8217;t an array, but something that is <a href=\"http://www.w3.org/TR/DOM-Level-2-Core/core.html#ID-536297177\">array-like</a>.) This adds up when you make the call once per iteration of the loop. We move it out of the loop so that we only call it once. Check out <a href=\"http://jsperf.com/loop-iteration-length-comparison-variations\">this test</a>. Performance optimizations are tricky and change every time new browsers are released. It&#8217;s easy to get confused, and I recommend profiling your code frequently to look for hot spots rather than just guessing about optimizations. I hope to talk more about them later, but if you want more now check out the book <a href=\"http://www.amazon.com/Performance-JavaScript-Faster-Application-Interfaces/dp/059680279X\">High Performance JavaScript</a> by <a href=\"http://www.nczonline.net/\"> Nicholas C. Zakas</a>.</p><br /><br /><p><em>I had originally written my loops using the newer <a href=\"https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/forEach\">Array.forEach</a> to iterate over <code>entities</code>. However, this proved to be <strong>significantly</strong> slower than a <code>for</code> loop.</em></p><br /><br /><p>The screen&#8217;s <code>draw</code> method also resets the canvas at the beginning of each iteration. If we did not do this, then every thing we drew on previous frames would still be present. For the start screen, I used <code>clearRect</code> however here I used <code>fillRect</code> with a solid color.</p><br /><br /><p>Here&#8217;s a function that will produce a simple enemy. It follows the same structure we&#8217;ve been using, <code>update</code> to handle the behavior and <code>draw</code> to actually draw it on the screen.</p><br />\n<h2>Some Bad Guys</h2><br /><br /><p>Our enemy ships are a little more complicated than the screen they live on. Visually, they <em>appear</em> to have two components. The little yellow rectangle that moves about the screen and the phantom target that they project as a little red circle. In the final game, they will target one of the player&#8217;s units. However, the logic is very similar. In fact, it may become useful in debugging to how each enemy ship render something over it&#8217;s actual target.</p><br />\n<h3>Implementation</h3><br /><br /><script src=\"https://gist.github.com/5084429.js\"></script><br /><br />\n<h3>Explanation</h3><br /><br /><p>Each enemy ship will be responsible for tracking its own state. In this code, the state is captured in a closure. In later code, we&#8217;ll track the track in a more traditional way. (I haven&#8217;t ran tests yet but I think that using a closure may have a performance impact.)</p><br /><br /><p>All of these variables represent the enemy ship&#8217;s state.</p><br /><br /><pre><code>var position = { x: 0, y: 0 };\nvar orientation = 0;\nvar turnSpeed = fullCircle / 50;\nvar speed = 2;\nvar target = findNewTarget();  \n</code></pre><br /><br /><p><code>position</code> is the location on the screen where we will render our ship.</p><br /><br /><p><em>Technically, the is the position in &#8220;world space&#8221;. World space is the logical space that entities in your game &#8220;live in&#8221;. This is distinct from &#8220;screen space&#8221;, which corresponds to the actual pixels on the screens. You can think of it this way: in your game you might have a circle with a radius of 10 and located at (100,100). However, where you draw it on the screen will depend upon where the player is viewing it from. If the player zooms in, the circle will grow larger but this doesn&#8217;t change the logical position or radius of the circle. We use the term &#8220;projection&#8221; to describe this. We project from world space into screen space based upon how the player is viewing the game world. The simplest project of course is just 1:1. Which means that there is no difference between world space and screen space. That&#8217;s what will stick with for the moment.</em></p><br /><br /><p><code>orientation</code> is the direction the ship is currently facing. Our ship will always travel in the direction of its orientation. This constraints causes the ship travel in smooth arcs as opposed to abruptly changing its course.</p><br /><br /><p><code>turnSpeed</code> and <code>speed</code> represent how quickly the ship can turn and how fast it can travel respectively. We won&#8217;t be modifying these values after setting them, which means the ship will turn and travel at constant rates. These values represent the rates of change for <code>orientation</code> and <code>position</code>. Note also, we defined <code>turnSpeed</code> in terms of <code>fullCircle</code>. This is an alias for <code>Math.PI * 2</code>; we are dealing in <a href=\"http://en.wikipedia.org/wiki/Radian\">radians</a> and not degrees.</p><br /><br /><p><code>target</code> is a value with the shape <code>{ x: Number, y: Number }</code>. The ship will always attempt to move towards this value by adjusting its <code>orientation</code>.</p><br />\n<h4>Update</h4><br /><br /><p>The <code>update</code> function is the real meat of the enemy ship. First, we check to see if we are close to our target. If we are close enough, we consider our goal accomplished and we set a new target. Otherwise, we change our <code>orientation</code> so that we are flying toward our current target.</p><br /><br /><pre><code>var y = target.y - position.y;\nvar x = target.x - position.x;\nvar d2 = Math.pow(x, 2) + Math.pow(y, 2);\n</code></pre><br /><br /><p><img class=\"right\" src=\"http://dev.bennage.com/images/posts/game-dev-move-02.png\" title=\"[calculating the distance]\" ></p><br /><br /><p>Here, <code>x</code> and <code>y</code> are really the distance between <code>target</code> and <code>position</code> along the respective axises. We want to know these values in order to calculate the distance between them. In general, you use the <a href=\"http://en.wikipedia.org/wiki/Pythagorean_theorem\">Pythagorean theorum</a> to calculate distance. <em>For deeper dive into the math, watch <a href=\"http://www.khanacademy.org/video/distance-formula\">Distance Formula</a> on Khan Academy.</em> Finding the actual real distance uses a square root and calculating a square root is an expensive operation that&#8217;s best to avoid whenever you can.</p><br /><br /><p>We can bypass the need by working with the distance&sup2; (hence the variable name <code>d2</code>). We compare this against the hard-coded value of 16 (that&#8217;s 4&sup2;). In other words, if the distance between the ship and its target is less than 4 units we find a new target.</p><br /><br /><pre><code>if (d2 &lt; 16) {\n    target = findNewTarget();\n}\n</code></pre><br /><br /><p>Once we&#8217;ve established what the ship&#8217;s target should be, we want the ship to move toward the target. As I&#8217;ve just mentioned, I&#8217;ve chosen to have the ship move at a constant speed. This means that it does not slow down or speed up. The only thing it can do is to change the direction it&#8217;s facing (<code>orientation</code>). These sort of constraints determine the personality and character of your game. Bear in mind, you don&#8217;t need to simulate the physics to have a fun game. Instead, you need to establish behaviors for your game entities that are merely fun. Fortunately, fun behaviors can often be easier to implement that the actual physics. I recommend taking a look at <a href=\"http://jsfiddle.net/bennage/HqYeD/18/\">the demo</a> and tweaking the <code>turnSpeed</code> and <code>speed</code> values to get a small taste for how the behavior can affect the game&#8217;s character.</p><br /><br /><p><img class=\"right\" src=\"http://dev.bennage.com/images/posts/game-dev-move-03.png\" title=\"[what's the delta between the angles?]\" ></p><br /><br /><p>In order to change the ship&#8217;s orientation we need to first determine where the ship <em>ought</em> to be facing. The values of <code>x</code> and <code>y</code> we just calculated can be interpreted as a <a href=\"http://en.wikipedia.org/wiki/Euclidean_vector\">vector</a>. Meaning, it represents the direction and distance (magnitude) from the ship to the current target. To extract the actual angle (in radian) we use <code>Math.atan2(x,y)</code>.</p><br /><br /><pre><code>var angle = Math.atan2(y, x);\nvar delta = angle - orientation;\n</code></pre><br /><br /><p>So now we have the direction the ship <em>wants</em> to face, <code>angle</code>, and the direction that it <em>is</em> facing, <code>orientation</code>. We calculate the difference between them and store it as <code>delta</code>.</p><br /><br /><p><img class=\"right\" src=\"http://dev.bennage.com/images/posts/game-dev-move-04.png\" title=\"[turning the wrong way]\" ></p><br /><br /><p>The basic idea is that add the value of <code>turnSpeed</code> to <code>orientation</code> once each invocation of <code>udpate</code> until <code>delta</code> is 0 (meaning that the ship is flying directly at the target). However, some values of <code>delta</code> will cause the ship to &#8220;turn the wrong way&#8221;. For example, imagine that the ship is facing the top of the screen and that we&#8217;ve defined that as <code>orientation === 0</code>. Now, imagine that the target is directly to its right. The value of <code>angle</code> would be &pi;/2 (or 90&deg;). Adding <code>turnSpeed</code> to <code>orientation</code> each frame increments the value from 0 to &pi;/2. However, if the target is directly to the left, then the value of <code>angle</code> would be 3&pi;/2 (or 270&deg;). Simply incrementing <code>orientation</code> would cause the ship to turn right and keep turning right. This is unintuitive behavior; we expect the ship to turn the shorted distance. In order to accomplish this, we translate any value of <code>delta</code> higher than &pi; (180&deg;) by subtracting <code>fullCircle</code>. This normalizes the value of <code>delta</code> between -&pi; and &pi; (or between -180&deg; and 180&deg;).</p><br /><br /><pre><code>var delta_abs = Math.abs(delta);\nif (delta_abs &gt; Math.PI) {\n    delta = delta_abs - fullCircle;\n}\n</code></pre><br /><br /><p>We take the absolute value of <code>delta</code> because otherwise we&#8217;d have to check for <code>delta &lt; -Math.PI</code> as well. Also, we&#8217;ll use <code>delta_abs</code> again.</p><br /><br /><p>If <code>delta</code> is 0, we don&#8217;t need to change <code>orientation</code>. When it is different we need to modify the value of <code>orientation</code>.</p><br /><br /><pre><code>if (delta !== 0) {\n    var direction = delta / delta_abs;\n    orientation += (direction * Math.min(turnSpeed, delta_abs));\n    orientation %= fullCircle;\n}\n</code></pre><br /><br /><p>First, we decide <em>how much</em> to change it using <code>Math.min(turnSpeed, delta_abs)</code>. We could just use <code>turnSpeed</code>. However if we did it&#8217;s likely that <code>delta</code> would never quite be 0 and (depending on the size of <code>turnSpeed</code>) it could result is jittery motion. Secondly, we want to decided which <em>direction</em> to turn: positive values to the right and negative values to the left. We multiply the amount <code>direction</code> to change the sign, because <code>direction</code> will only ever be 1 or -1. Finally, we modulo <code>orientation</code> to ensure that it stays within a range of -2&pi; to 2&pi;. Otherwise, the calculation of <code>delta</code> would be off.</p><br /><br /><p>Our last step in <code>update</code> is to modifiy the actual position using the latest <code>orientation</code> and <code>speed</code>.</p><br /><br /><pre><code>position.x += Math.cos(orientation) * speed;\nposition.y += Math.sin(orientation) * speed;\n</code></pre><br /><br /><p><em>Some basic trigonometry is fairly fundamental for most game development. If you&#8217;re mathematically lost at this point, I recommend <a href=\"https://www.khanacademy.org/math/trigonometry/basic-trigonometry\">reviewing over at Khan Academey</a>.</em></p><br /><br /><p>Here&#8217;s the geometric interpretation of the code. We want the ship to move a distance of <code>speed</code> in the direction of <code>orientation</code>. To do this, we need to project this vector (distance and direction) on the x and y axises. Since the distance is the length of the hypothenuse of right triangle, cosine gives us the x part and sine gives us the y part. We can then add these values to the current position.</p><br />\n<h4>Draw</h4><br /><br /><p>Drawing the ship to the screen is a bit easier to follow. Here&#8217;s the flow of the logic:</p><br />\n<ul><br /><li>Save the state of the drawing context.</li>\n<li>Transform the context to make it easier to draw our ship.</li>\n<li>Draw the ship.</li>\n<li>Restore the context back to its original state.</li>\n<li><p>Draw the target</p><br /><br /><pre><code>  function draw(ctx) {\n\n      ctx.save();\n\n      ctx.translate(position.x, position.y);\n      ctx.rotate(orientation);\n\n      ctx.fillStyle = 'yellow';\n      ctx.fillRect(-3, -1, 6, 2);\n\n      ctx.restore();\n\n      ctx.beginPath();\n      ctx.fillStyle = 'rgba(255,0,0,0.5)';\n      ctx.arc(target.x, target.y, 2, 0, Math.PI * 2, true);\n      ctx.fill();\n  }\n</code></pre></li>\n</ul>\n<br /><br /><p>Recall that <code>ctx</code> is the drawing context for the canvas. The context provide a useful API that allows us to move it around before we draw on it. This is analgous to having a sheet of paper that you might shift and rotate in order to make it easier to draw something complicated. This is the purpose of the <code>translate</code> and <code>rotate</code> methods.</p><br /><br /><p>First, we use &#8216;save&#8217; to establishing a checkpoint for the drawing context that we can easily revert back to using &#8216;restore.&#8217; The calls to <code>translate</code> and <code>rotate</code> modify the state of the drawing context. This modified state is very specific to the drawing of our enemy ship. If we didn&#8217;t translate and rotate the canvas, we&#8217;d have to do a lot more work to figure out where to draw the four corners of the rectangle.</p><br /><br /><p>I decided that I want my ship to be 6px long and 2px wide. Since I want the middle of the middle of my ship to be the point where it rotates, I shift by half the length and half the width. Hence, the values passed to <code>ctx.fillRect(-3, -1, 6, 2)</code>. This point the new origin (0,0) at the middle of the rectangle, and it makes our call to <code>rotate</code> behave intuitively. If we used <code>ctx.fillRect(0, 0, 6, 2)</code> instead, then the ship would appear to rotate around its upper left corner. We&#8217;ll use these same techniques once we switch to using <em>sprites</em>.</p><br /><br /><p>After we restore the context&#8217;s state, we draw the target. We don&#8217;t bother using <code>rotate</code> because it&#8217;s meaningless to rotate a simple circle. Likewise, we don&#8217;t bother <code>translate</code> since the drawing logic is so simple.</p><br /><br /><p><em>The canvas is a broad topic in itself. I recommend taking a look at the tutorials over at <a href=\"https://developer.mozilla.org/en-US/docs/HTML/Canvas\">MDN</a>. A handy reference for the APIs themselves can be found on <a href=\"http://msdn.microsoft.com/en-us/library/ff975057\">MSDN</a>.</em></p><img src=\"http://feeds.feedburner.com/~r/ChristopherBennage/~4/p3hLlTS9YSc\" height=\"1\" width=\"1\"/></p></div><div class=\"entry\"><div class=\"title\"><a href=\"http://feedproxy.google.com/~r/ChristopherBennage/~3/FDRYxa5Q_EA/\">Building a Game with JavaScript: Start Screen</a></div><div class=\"moreinfo\"><span class=\"date\">Friday, January 11, 2013</span> &nbsp;|&nbsp; <span class=\"source\">From <a target=\"_blank\" href=\"http://feeds.feedburner.com/ChristopherBennage\">Christopher Bennage</a></span></div><p><p>This is a continuation from the <a href=\"http://dev.bennage.com/blog/2012/12/07/game-dev-01/\">previous post</a>.</p><br />\n<h2>Specification</h2><br /><br /><p>Many games have a start screen or main menu of some sort. (Though I love games like <a href=\"http://www.braid-game.com/\">Braid</a> that bypass the whole notion.) Let&#8217;s begin by designing our start screen.</p><br /><br /><p><img class=\"right\" src=\"http://dev.bennage.com/images/posts/game-dev-startscreen-01.png\" title=\"[our simple start screen]\" ></p><br /><br /><p>We&#8217;ll have a solid color background. Perhaps the ever lovely cornflower blue. Then we&#8217;ll draw the name of our game and provide an instruction to the player. In order to make sure we have the player&#8217;s attention, we&#8217;ll animate the color of the instruction. It will morph from black to red and back again.</p><br /><br /><p>Finally, when the player clicks the screen we&#8217;ll transition to the main game. Or at least we&#8217;ll stub out the transition.</p><br /><br /><p>Here&#8217;s a <a href=\"http://jsfiddle.net/bennage/HqYeD/2/\">demo</a> based on the code we&#8217;ll cover later in this post (as well as that from the previous post.)</p><br />\n<h2>Implementation</h2><br /><br /><p>Here&#8217;s the code to implement our start screen.</p><br /><br /><script src=\"https://gist.github.com/4371311.js\"></script><br /><br />\n<h2>Explanation</h2><br /><br /><p>Recall that our start screen is meant to be invoked by our game loop. The game loop doesn&#8217;t know about the specifics of the start screen, but it does expect it to have a <em>certain shape</em>. This enables us to swap out screen objects without having to modify the game loop itself. The shape that the game loop expects is this:</p><br /><br /><pre><code>{\n    update: function(timeElapsedSinceLastFrame) { },\n    draw: function(drawingContext) { }\n}\n</code></pre><br />\n<h3>Update</h3><br /><br /><p>Let&#8217;s begin with the start screen&#8217;s <code>update</code> function. The first bit of logic is this:</p><br /><br /><pre><code>hue += 1 * direction;\nif (hue &gt; 255) direction = -1;\nif (hue &lt; 0) direction = 1;\n</code></pre><br /><br /><p>Perhaps <code>hue</code> is not the best choice of variable names. It represents the red component for an <a href=\"http://en.wikipedia.org/wiki/RGB_color_model\">RGB color</a> value. The range of values for this component is <code>0</code> (no red) to <code>255</code> (all the reds!). On each iteration of our loop we &#8220;move&#8221; the hue towards either the red or black.</p><br /><br /><p>The variable <code>direction</code> can be either <code>1</code> or <code>-1</code>. A value of <code>1</code> means we are moving towards <code>255</code> and a value of <code>-1</code> means we are moving towards <code>0</code>. When we cross a boundary, we flip the direction.</p><br /><br /><p>Keen observers will ask why we bother with <code>1 * direction</code>. In our current logic, it&#8217;s an unnecessary step and unnecessary steps in game development are generally bad. In this case, I wanted to separate the rate of change from the direction. In order words, you could modify that expression to <code>2 * direction</code> and the color would change twice as fast.</p><br /><br /><p>This leads us to another important point. Our rate of change is tied to how quickly our loop iterates; most likely 60fps. However, it&#8217;s not guaranteed to be 60fps and that makes this approach a dangerous practice. Once way to detach ourselves from the loop&#8217;s speed would be to use the elapsed time that is being passed into our <code>update</code> function.</p><br /><br /><p>Let&#8217;s say that we want to it to take 2 full seconds to go from red to black regardless of how often the <code>update</code> function is called. There&#8217;s a span of 256 discrete values between red and black. To make our calculations clear, let&#8217;s say there are 256 units and we&#8217;ll label these units <strong>R</strong>. Also, the elapsed time will be in milliseconds (ms). For a given frame, if were are given a slice of elapsed time in ms, we&#8217;ll want to calculate how many <strong>R</strong> units to increase (or decrease) <code>hue</code> by for that slice. Our rate of change can be defined as <code>256 **R** / 2000 **ms**</code> or 0.128 <strong>R/ms</strong>. (You can read that as &#8220;0.128 units of red per millisecond&#8221;.) This rate of change is a constant for our start screen and as such we can define it once (as opposed to calculating it inside the <code>update</code> function).</p><br /><br /><p>Now that we have the rate of change , we only need to multiply it by the elapsed time received in <code>update</code> to determine how many <strong>R</strong>s we want. A revised version of the function would look like this:</p><br /><br /><pre><code>var rate = 0.128; // R/ms\n\nfunction update(elapsed) {\n    var amount = rate * elapsed;\n    hue += amount * direction;\n    if (hue &gt; 255) direction = -1;\n    if (hue &lt; 0) direction = 1;\n}\n</code></pre><br /><br /><p>One consequence of this change is that hue will no longer be integral values (as much as that can be said in JavaScript.) This means that we&#8217;d really want to have two values for the hue: an actual value and a rounded value. This is because the RBG model requires an integral value for each color component.</p><br /><br /><pre><code>function update(elapsed) {\n    var amount = rate * elapsed;\n    hue += amount * direction;\n    if (hue &gt; 255) direction = -1;\n    if (hue &lt; 0) direction = 1;\n\n    rounded_hue = Math.round(hue);\n}\n</code></pre><br />\n<h3>Draw</h3><br /><br /><p>Let&#8217;s turn our attention to <code>draw</code> for a moment. One of the first things you <em>generally</em> do is to clear the entire screen. This is simple to do with the canvas API&#8217;s <code>clearRect</code> method.</p><br /><br /><pre><code>ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\n</code></pre><br /><br /><p>Notice that <code>ctx</code> is an instance of <a href=\"http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#canvasrenderingcontext2d\">CanvasRenderingContext2D</a> and not a <a href=\"http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#the-canvas-element\">HTMLCanvasElement</a>. However, there is a handy back reference to the canvas element that we use to grab the actual width and height.</p><br /><br /><p>There are other options other than clearing the entire canvas, but I&#8217;m not going to address this in this post. Also, there are some performance considerations. See the article listed under references.</p><br /><br /><p>After clearing the screen, we want to draw something new. In this case, the game title and the instructions. In both cases I want to center the text horizontally. I created a helper function that I can provide with the text to render as well as the vertical position (y).</p><br /><br /><pre><code>function centerText(ctx, text, y) {\n    var measurement = ctx.measureText(text);\n    var x = (ctx.canvas.width - measurement.width) / 2;\n    ctx.fillText(text, x, y);\n}\n</code></pre><br /><br /><p><code>measureText</code> returns the width in pixels that the rendered text will take up. We use this in combination with the canvas element&#8217;s width to determine the x position for the text. <code>fillText</code> is responsible for actually drawing the text.</p><br /><br /><p>The rendering context <code>ctx</code> is stateful. Meaning that, what happens when you call methods like <code>measureText</code> or <code>fillText</code> depends on the state of the rendering context. The state can be modified by setting its properties.</p><br /><br /><pre><code>var y = ctx.canvas.height / 2;\nctx.fillStyle = 'white';\nctx.font = '48px monospace';\ncenterText(ctx, 'My Awesome Game', y);\n</code></pre><br /><br /><p>The properties <code>fillStyle</code> and <code>font</code> change the state of the rendering context and hence affect the methods calls inside of <code>centerText</code>. This state applies to all future methods calls. This means that all calls to <code>fillText</code> will use the color white until you can the <code>fillStyle</code>.</p><br /><br /><p>Notice too that we are calculating the x and y values for the text on every frame. This is potentially wasteful since these values are unlikely to change. However, if we want to respond to changes in canvas size (or even changes to the text itself) then we&#8217;d want to continue calculating these on every frame. Otherwise, if we were confident that we didn&#8217;t need to do this, we could calculate these values once and cache them.</p><br /><br /><p>Now let&#8217;s use the red component calculated in <code>update</code> to render the instructional text.</p><br /><br /><pre><code>var color = 'rgb(' + hue + ',0,0)';\n\nctx.fillStyle = color;\nctx.font = '24px monospace';\ncenterText(ctx, 'click to begin', y + 30);\n</code></pre><br /><br /><p><code>fillStyle</code> can be set in a number of ways. Earlier, we used the simple value <code>white</code>. Here were are using <code>rgb()</code> to set the individual components explicitly. Any <a href=\"https://developer.mozilla.org/en-US/docs/CSS/color\">CSS color</a> <em>should</em> work with <code>fillStyle</code>.  (I won&#8217;t be too surprised if some don&#8217;t though.)</p><br /><br /><p>Now you might be wondering why we bothered calculating <code>hue</code> inside <code>update</code> since <code>hue</code> is all about what to draw on the screen. The reason is that <code>draw</code> is concerned with the <em>mechanics</em> of rendering. Anything that is modeling the game state should live in <code>update</code>. The tell in this example is that <code>hue</code> is dependent on elapsed time and the <code>draw</code> doesn&#8217;t know anything about that.</p><br />\n<h3>Update (again)</h3><br /><br /><p>Moving back to <code>update</code>, the next bit deals with input from the player. In the sample code I&#8217;ve extracted the input logic away. The key thing here is that we are not relying on events to tell us about input from the player. Instead we have some helper, <code>input</code> in this case, that gives us the current state of the input. If event-driven logic says &#8220;tell me when this happens&#8221; then our game logic says &#8220;tell me if this is happening now&#8221;. The primary reason for this is to be deterministic. We can establish at the beginning of our <code>update</code> what the current input state is and that it won&#8217;t change before the next invocation of the function. In simple games this might be inconsequential, but in others it can be a subtle source of bugs.</p><br /><br /><pre><code>var isButtonDown = input.isButtonDown();\n\nvar mouseJustClicked = !isButtonDown &amp;&amp; wasButtonDown;\n\nif (mouseJustClicked &amp;&amp; !transitioning) {\n    transitioning = true;\n    // do something here to transition to the actual game\n}\n\nwasButtonDown = isButtonDown;\n</code></pre><br /><br /><p>We only want transition when the mouse button has been released. In this case, &#8220;released&#8221; is defined as &#8220;down on the last frame but up on this one&#8221;. Hence, we need to track what the mouse button&#8217;s state was on the <em>last</em> frame. That&#8217;s <code>wasButtonDown</code> and it lives outside of <code>update</code>.</p><br /><br /><p>Secondly, we don&#8217;t want to trigger multiple transitions. That is, if our transition takes some time (perhaps due to animation) then we want to ignore subsequent clicks. We have our <code>transitioning</code> variable outside of <code>update</code> to track that for us.</p><br /><br /><p>More to come&#8230;</p><br />\n<h2>Reference</h2><br />\n<ul><br /><li><a href=\"http://www.html5rocks.com/en/tutorials/canvas/performance/\">Canvas Performace</a></li>\n</ul><img src=\"http://feeds.feedburner.com/~r/ChristopherBennage/~4/FDRYxa5Q_EA\" height=\"1\" width=\"1\"/></p></div><div class=\"entry\"><div class=\"title\"><a href=\"http://feedproxy.google.com/~r/ChristopherBennage/~3/nocjOKsgZDE/\">Building a Game with JavaScript</a></div><div class=\"moreinfo\"><span class=\"date\">Friday, December 07, 2012</span> &nbsp;|&nbsp; <span class=\"source\">From <a target=\"_blank\" href=\"http://feeds.feedburner.com/ChristopherBennage\">Christopher Bennage</a></span></div><p><p><em>See the <a href=\"http://dev.bennage.com/blog/2012/12/07/a-n00bs-look-at-html5-game-development/\">introduction post</a> for context.</em></p><br />\n<h2>The Loop</h2><br /><br /><p>In general, game development begins with the game loop. If you come from the business world of software development, this will be strange. You don&#8217;t rely on events. <a href=\"http://haacked.com/\">Phil Haack</a> once asked me &#8220;why a loop?&#8221;, to which I responded &#8220;uh&#8230;&#8221;. However, a much better answer would have been <a href=\"http://stackoverflow.com/questions/2565677/why-is-a-main-game-loop-is-necessary-for-developing-a-game\">this one on stackoverflow</a>.</p><br /><br /><p>Okay, so we should use a master loop. If our runtime is the browser, how do setup this loop? There&#8217;s a relatively new API called <a href=\"http://www.w3.org/TR/animation-timing/\"><code>requestAnimationFrame</code></a> and that&#8217;s what most folks recommend. Check out these for details:</p><br />\n<ul><br /><li><a href=\"http://paulirish.com/2011/requestanimationframe-for-smart-animating/\">Paul Irish</a></li>\n<li><a href=\"http://ie.microsoft.com/testdrive/Graphics/RequestAnimationFrame/Default.html\">The IE Team</a></li>\n</ul>\n<br /><br /><p>(I do recall reading something negative along the way about the API, but I couldn&#8217;t find it again.)</p><br /><br /><p>I used the <code>requestAnimationFrame</code> <a href=\"https://gist.github.com/1579671\">shim</a> referenced in the Paul Irish post above. The shim is only necessary for older browsers that have not implemented the API. <em>By the way, we refer to each iteration of the loop as a &#8220;frame&#8221; because of the analogy with traditional animation.</em></p><br />\n<h3>Implementation</h3><br /><br /><p>Now that we&#8217;ve ensured that <code>requestAnimationFrame</code> is present we can get to our game loop. Here is my game&#8217;s bootstrap code (well, an early version of it):</p><br /><br /><script src=\"https://gist.github.com/4238210.js?file=boostrap.js\"></script><br /><br /><br /><p>The heart of this the <code>loop</code> function. It has the following step:</p><br />\n<ul><br /><li>capture the current time</li>\n<li>calculate the time that has elasped since the last frame</li>\n<li>execute the game&#8217;s logic for the frame (that&#8217;s the update and draw invocations)</li>\n<li>request the next invocation of <code>loop</code> using <code>requestAnimationFrame</code></li>\n<li>record the current time of the this frame for calculations in the next one</li>\n</ul>\n<br /><br /><p><em>N.B. This code doesn&#8217;t use <code>frameId</code> yet. The idea is that this handle could be used to halt the loop.</em></p><br /><br /><p>The <code>beginLoop</code> function is there merely to provide a closure for some of the variables used to track the state of the loop. It kicks off the loop with its initial invocation of <code>loop</code>.</p><br /><br /><p>The big mystery inside of <code>loop</code> is the <code>currentScreen</code> object. Here I was thinking ahead (which can be dangerous). I know that my game will have at least two &#8220;screens&#8221;, possibly more:</p><br />\n<ul><br /><li>start menu screen</li>\n<li>main game screen (where the action takes place)</li>\n</ul>\n<br /><br /><p>I wanted the loop logic to work with both (as well as any future screens). I expect screen objects to have two methods:</p><br />\n<ul><br /><li><code>update</code> takes the time elapsed since the last frame and is responsible for updating the state of the game.</li>\n<li><code>draw</code> takes the drawing context (from the canvas) and is responsible for rendering the current state of the game.</li>\n</ul>\n<br /><br /><p>You&#8217;ll also see that I grab a canvas element and capture its drawing context. If you are not familiar with the canvas APIs, I recommend that you <a href=\"https://developer.mozilla.org/en-US/docs/HTML/Canvas\">start here</a>.</p><br /><br /><p><em>Why two different methods for game logic?</em></p><br /><br /><p>Keeping the <code>update</code> and <code>draw</code> functions separate is important. When frames becomes expensive to compute, the game may respond with lag or non-deterministic behavior. Too avoid this, you might want your game to skip over some logic during a particular iteration of the loop. However, it&#8217;s very likely that you <em>won&#8217;t</em> want to drop calls to <code>update</code>. It&#8217;s not necessary a big deal if you skip <em>rendering</em> a couple of frames, however if skip calculating the location of a projectile then it might mysteriously &#8220;pass through&#8221; its target. This will become more relevant to us in particular, because I&#8217;d like to all the player to control the speed of game (a common feature of many tower defense games).</p><br /><br /><p>Right now <code>update</code> and <code>draw</code> are always called for each iteration of the loop, so the distinction is academic in this context. We could though calculate our frame rate in <code>loop</code> and occasionally skip invoking <code>draw</code> if the rate slowed down.</p><br /><br /><p>Now we have enough in place to begin working on our start menu screen.</p><img src=\"http://feeds.feedburner.com/~r/ChristopherBennage/~4/nocjOKsgZDE\" height=\"1\" width=\"1\"/></p></div><div class=\"entry\"><div class=\"title\"><a href=\"http://feedproxy.google.com/~r/ChristopherBennage/~3/hbLXQQR5GJU/\">a n00b's look at HTML5 game development</a></div><div class=\"moreinfo\"><span class=\"date\">Friday, December 07, 2012</span> &nbsp;|&nbsp; <span class=\"source\">From <a target=\"_blank\" href=\"http://feeds.feedburner.com/ChristopherBennage\">Christopher Bennage</a></span></div><p><h2>Preamble</h2><br /><br /><p>Something disgusting, like six years ago, I <a href=\"http://www.43things.com/things/view/33927/develop-a-video-game\">listed on 43Things</a> that I wanted to write a video game. I&#8217;ve actually made numerous arrested attempts ever since I started programming with my TI-94a back in 1983. My last attempt has been much less arrested (though still incomplete).</p><br /><br /><p>I&#8217;ve learned a lot in my most recent endeavor, so it&#8217;s time to share. You can follow the <a href=\"https://github.com/bennage/sidera\">actual work in progress</a>, but my plan it to recreate the steps I&#8217;ve gone though over the course of a few posts.</p><br />\n<h2>Goals</h2><br /><br /><p>I am too ambitious. With that in mind, I created a set of constraints for making a game.</p><br />\n<ul><br /><li>keep gameplay simple</li>\n<li>don&#8217;t worry about art (that can come later)</li>\n</ul>\n<br /><br /><p>I started off wanting to make a game for the Windows 8 store. I decided afterwards that I will target modern browsers in general. This means that I took no dependencies on the WinJS libraries. (Though the Windows store is still my endgame.)</p><br /><br /><p>I also decided to <em>not</em> use any frameworks (such as <a href=\"http://impactjs.com/\">ImpactJS</a>). Not because they are bad, but because I want to learn why I need them.</p><br />\n<h2>Gameplay</h2><br /><br /><p><img class=\"right\" src=\"http://dev.bennage.com/images/posts/sidera-early-build.png\" title=\"[screen capture of the current build of my game]\" ></p><br /><br /><p>This is my spec (well, more or less).</p><br /><br /><p>I decided to make a simple <a href=\"http://en.wikipedia.org/wiki/Tower_defense\">tower defense</a> game. My inspiration is <a href=\"http://old.casualcollective.com/#games/TSG\">The Space Game</a> from the Casual Collective, as well as plenty of influence from StarCraft.</p><br /><br /><p>The player will build structures in an asteroid field. Waves of enemy ships will attempt to destroy those structures. The player has to manage resources such as minerals and solar power, and fend of the attacks. Structures will cost minerals to build and require power to operate.</p><br /><br /><p>The player can navigate the map (up, down, left, right) as well as zooming in and out. There will be a minimap.</p><br /><br /><p>Graphics will be sprite-based. The game should be touch-friendly (really, I want touch to be primary).</p><br />\n<h2>Resources</h2><br />\n<ul><br /><li><p><a href=\"http://buildnewgames.com/\">Build New Games</a>, a collaboration between Microsoft and <a href=\"http://bocoup.com/\">Bocoup</a>, is an excellent set of articles on HTML/JavaScript game development.</p></li>\n<li><p>My friend, <a href=\"http://mattmadegames.com/\">Matt Peterson</a>, currently a graduate student at <a href=\"https://www.digipen.edu/\">DigiPen</a>, who&#8217;s advice and guidance has been most useful.</p></li>\n</ul><img src=\"http://feeds.feedburner.com/~r/ChristopherBennage/~4/hbLXQQR5GJU\" height=\"1\" width=\"1\"/></p></div><div class=\"entry\"><div class=\"title\"><a href=\"http://feedproxy.google.com/~r/ChristopherBennage/~3/IiFduAlgipk/\">Symposium 2013</a></div><div class=\"moreinfo\"><span class=\"date\">Tuesday, December 04, 2012</span> &nbsp;|&nbsp; <span class=\"source\">From <a target=\"_blank\" href=\"http://feeds.feedburner.com/ChristopherBennage\">Christopher Bennage</a></span></div><p><p>Our annual (or mostly annual) conference is coming up in Janaury. I&#8217;m <em>really</em> excited about our set of speakers. Including:</p><br />\n<ul><br /><li><a href=\"https://twitter.com/steltzner\">Adam Steltzner</a> from NASA&#8217;s <a href=\"http://www.jpl.nasa.gov/msl/\">Mars Curiosity</a>.</li>\n<li><a href=\"http://www.felicityaston.co.uk/\">Felicity Aston</a> the first woman in the world to ski across Antarctica alone.</li>\n</ul>\n<br /><br /><p><img class=\"right\" src=\"http://dev.bennage.com/images/posts/pnpsym2013.png\"></p><br /><br /><p>Really, we have too many great speakers to list. The spectrum ranges from <a href=\"http://www.hanselman.com/blog/\">Scott Hanselman</a> to <a href=\"http://www.devthought.com/\">Guillermo Rauch</a>.</p><br /><br /><p>Check out the <a href=\"http://lanyrd.com/2013/pnp-symposium/speakers/\">full list of speakers</a>.</p><br /><br /><p>The event is in <strong>Remond, WA</strong> on Microsoft&#8217;s campus. The dates are <strong>Janauary 15 - 17</strong>.</p><br /><br /><p>Regsistration is <strong>$498</strong>.</p><br /><br /><p>You can <a href=\"http://aka.ms/symposium\">read all the detaisl</a> or you can jump straight to <a href=\"http://www.regonline.com/Register/Checkin.aspx?EventID=1150970\">the registration</a>.</p><br /><br /><p>I look forward to seeing you there!</p><img src=\"http://feeds.feedburner.com/~r/ChristopherBennage/~4/IiFduAlgipk\" height=\"1\" width=\"1\"/></p></div><div class=\"entry\"><div class=\"title\"><a href=\"http://feedproxy.google.com/~r/ChristopherBennage/~3/jtcLyUOQv1w/\">Technical Interviews</a></div><div class=\"moreinfo\"><span class=\"date\">Friday, November 16, 2012</span> &nbsp;|&nbsp; <span class=\"source\">From <a target=\"_blank\" href=\"http://feeds.feedburner.com/ChristopherBennage\">Christopher Bennage</a></span></div><p><p>I&#8217;ve been responsible for the <em>technical evaluation</em> portion of some developer interviews recently. I stumbled through the first few, unhappy with my aged and worn approach of asking questions, having the candidate write pseudo code on a white-board, and so. A friend challenged me: he said that the interview should be a positive experience for the candidate even if they don&#8217;t get the job.</p><br /><br /><p>With that in mind, here&#8217;s what I decided to do.</p><br /><br /><p>A few days before an interview, I&#8217;d sent the candidate a link to a repository. Specifically, some code that p&amp;p had worked on and was publicly available. (I&#8217;d ask ahead of time what languages and platforms the candidate was comfortable with, and choose a code base accordingly.) I&#8217;d tell the candidate to be prepared to write some code during our time together.</p><br /><br /><p>Next, I&#8217;d pick two or three scenarios (stories or bugs) to work on with respect to that code base. However, I would not share the exact scenarios with the candidate ahead of time. I like to see how a candidate first reacts to a problem. It also give an opportunity to observe the candidate navigating unfamilar source as they acquaint themselves with what needs to be done.</p><br /><br /><p>I&#8217;d allow the candidate to bring their own computer (if they desired), to search the web (a very important skill), and to ask me questions. Furthermore, I would spend at least half of the time <a href=\"http://www.c2.com/cgi/wiki?PairProgrammingPingPongPattern\">ping-pong pairing</a>. They would write a test and then I&#8217;d implement it, we&#8217;d switch and so on.</p><br /><br /><p>I was also careful to share all of this with the candidate ahead of time. Being prepared is important, and I like to see how candidates prepare. Interviewing is not about solving clever tricks, it is about seeing if they can be a productive team member. My purpose was to simulate actual work.</p><br /><br /><p>I think that my approach still has plenty of room for improvement, but I like the direction it&#8217;s been going so far.</p><img src=\"http://feeds.feedburner.com/~r/ChristopherBennage/~4/jtcLyUOQv1w\" height=\"1\" width=\"1\"/></p></div><div class=\"entry\"><div class=\"title\"><a href=\"http://feedproxy.google.com/~r/ChristopherBennage/~3/ES71C4355Kk/\">WinJS: Unpacking Promises</a></div><div class=\"moreinfo\"><span class=\"date\">Tuesday, August 21, 2012</span> &nbsp;|&nbsp; <span class=\"source\">From <a target=\"_blank\" href=\"http://feeds.feedburner.com/ChristopherBennage\">Christopher Bennage</a></span></div><p><p>N.B. <em>If you don&#8217;t know anything about WinJS, take a moment to peruse <a href=\"http://dev.bennage.com/blog/2012/08/01/a-brief-introduction-to-winjs/\">this primer</a>. Also, the context of this post is the <a href=\"http://hilojs.codeplex.com/\">p&amp;p Hilo project</a>.</em></p><br /><br /><p><em>In particular, you should read about promises and <a href=\"http://msdn.microsoft.com/en-us/library/windows/apps/hh700330.aspx\">asynchronous programming in JavaScript</a>. Derick Bailey also wrote <a href=\"http://lostechies.com/derickbailey/2012/07/19/want-to-build-win8winjs-apps-you-need-to-understand-promises/\">about promises</a> on his blog.</em></p><br />\n<h2>A Bit About Promises</h2><br /><br /><p>A promise is an object. It is not a function and it is not the <em>value</em> returned from the async operation. To get to the value, you need to call the <code>then</code> method on the promise object. You pass a callback function as an argument to <code>then</code>. The promise invokes the callback and passes the value you&#8217;re interested in into the callback. Clear as mud, right?</p><br /><br /><p>Here&#8217;s a fictitious example that pretends like calculating a random number requires an async operation:</p><br /><br /><pre><code>getRandomNumberAsync().then(function(someNumber) { \n    // do stuff with `someNumber`\n});\n</code></pre><br /><br /><p>The call to <code>then</code> returns a promise itself. You could do this:</p><br /><br /><pre><code>getRandomNumberAsync().then(function(someNumber) { \n    // do stuff with `someNumber`\n}).then(function() {\n    // more stuff\n});\n</code></pre><br /><br /><p>Or written another way:</p><br /><br /><pre><code>var afterRandomNumber = getRandomNumberAsync().then(function(someNumber) { \n    // do stuff with `someNumber`\n});\n\nafterRandomNumber.then(function() {\n    // more stuff\n});\n</code></pre><br /><br /><p>The two example above are the <em>same</em>.</p><br /><br /><p>Now if our callback function returns a value, that value is passed along to the next promise&#8217;s callback.</p><br /><br /><pre><code>getRandomNumberAsync().then(function(someNumber) { \n    return someNumber + 1;\n}).then(function(someNumberPlusOne) {\n\n});\n</code></pre><br /><br /><p>This allows you to easily chain promises, piping the output of one into the next callback in the chain.</p><br /><br /><pre><code>getRandomNumberAsync().then(function(someNumber) { \n    return someNumber + 1;\n}).then(function(someNumberPlusOne) {\n    return someNumberPlusOne + 1;\n}).then(function(someNumberPlusTwo) {\n\n});\n</code></pre><br /><br /><p>Of course, this is a bit silly when then operations are not async. It&#8217;s more interesting when the thing you return from the callback is also a promise. Let&#8217;s make a another fictitious async function, this time one that needs input:</p><br /><br /><pre><code>getRandomNumberHigherThanAsync(10).then(function(someNumberOverTen){\n    // do something with `someNumberOverTen`\n});\n</code></pre><br /><br /><p>Now we can do this:</p><br /><br /><pre><code>getRandomNumberAsync().then(function(someNumber) { \n    return getRandomNumberHigherThanAsync(someNumber);\n}).then(function(something){\n    // What will `something` be?\n});\n</code></pre><br /><br /><p>In the example above, you might think that <code>something</code> will be the promise returned from <code>getRandomNumberHigherThanAsync</code>. It&#8217;s not. Instead, it&#8217;s the <em>value</em> that <code>getRandomNumberHigherThanAsync</code> produces and would pass into its callback. <em>Returning another promise from within the callback for a promise is a special case.</em> Though it&#8217;s probably the most frequent case.</p><br />\n<h2>Putting Promises Together</h2><br /><br /><p>Now let&#8217;s pretend we have a set of functions that all return promises, named <code>A</code> through <code>E</code>. If we wanted to execute them in sequence, passing the results from one to the next, we <em>could</em> write it this:</p><br /><br /><pre><code>A().then(function(a) {\n    return B(a).then(function(b){\n        return C(b).then(function(c){\n            return D(c).then(function(d){\n                return E(d);\n            });\n        });\n    });\n});\n</code></pre><br /><br /><p>Yeah, that hurts my eyes too. Though I found that I was writing my code <em>just like this</em> at first.</p><br /><br /><p>However, we should realize that <code>A.then()</code> returns a promise and that that promise completes only when all of the nested promises have completed. If we wanted to execute a new function <code>F</code> after all these steps, we could do it like this:</p><br /><br /><pre><code>var waitForAllToBeDone = A().then(function(a) {\n    return B(a).then(function(b){\n        return C(b).then(function(c){\n            return D(c).then(function(d){\n                return E(d);\n            });\n        });\n    });\n});\n\nwaitForAllToBeDone().then(function(e){\n    return F(e);\n});\n</code></pre><br /><br /><p>However, that last inline callback has the same signature as <code>F</code>. That means that we can simplify to this:</p><br /><br /><pre><code>waitForAllToBeDone().then(F);\n</code></pre><br /><br /><p>Now we realize that what we did for <code>F</code> is also true for <code>E</code>. In fact, it is true for the entire chain. We can simplify that nasty nested beast to:</p><br /><br /><pre><code>A().then(B).then(C).then(D).then(E).then(F);\n</code></pre><br /><br /><p>Much nicer.</p><br />\n<h2>A Real Example</h2><br /><br /><p>Let&#8217;s bring this home. While working on <a href=\"http://hilojs.codeplex.com/\">HiloJS</a> we needed to copy an image thumbnail to a new file. It sounds simple, but it requires the following steps:</p><br />\n<ol><br /><li>Open a file that we will write <em>to</em>. We&#8217;ll call this the <strong>target</strong> file.</li>\n<li>Get the thumbnail image from another file. We&#8217;ll call this the <strong>source</strong> file. (WinRT creates the thumbnail for us from the source.)</li>\n<li>Copy the stream from the thumbnail source to the target file&#8217;s input stream.</li>\n<li>Flush the output stream.</li>\n<li>Close both the input and the output stream.</li>\n</ol>\n<br /><br /><p>(Actually we don&#8217;t really care about the order of the first two steps. They could be switched.)</p><br /><br /><p>Our initial implementation looked liked this:</p><br /><br /><pre><code>function writeThumbnailToFile(sourceFile, targetFile) {\n\n    var whenFileIsOpen = targetFile.openAsync(fileAccessMode.readWrite);\n\n    return whenFileIsOpen.then(function (outputStream) {\n\n        return sourceFile.getThumbnailAsync(thumbnailMode.singleItem)).then(function (thumbnail) {\n            var inputStream = thumbnail.getInputStreamAt(0);\n            return randomAccessStream.copyAsync(inputStream, outputStream).then(function () {\n                return outputStream.flushAsync().then(function () {\n                    inputStream.close();\n                    outputStream.close();\n                });\n            });\n        });\n    });\n}\n</code></pre><br /><br /><p>Then we had a code review with the always helpful Chris Tavares. He pointed us in a more excellent direction. We were able to change the code to this:</p><br /><br /><pre><code>function writeThumbnailToFile(sourceFile, targetFile) {\n\n    var whenFileIsOpen = targetFile.openAsync(fileAccessMode.readWrite);\n    var whenThumbailIsReady = sourceFile.getThumbnailAsync(thumbnailMode.singleItem);\n\n    var whenEverythingIsReady = WinJS.Promise.join([whenFileIsOpen, whenThumbailIsReady]);\n\n    var inputStream, outputStream;\n\n    whenEverythingIsReady.then(function (args) {\n        outputStream = args[0];\n        var thumbnail = args[1];\n        inputStream = thumbnail.getInputStreamAt(0);\n        return randomAccessStream.copyAsync(inputStream, outputStream);\n\n    }).then(function () {\n        return outputStream.flushAsync();\n\n    }).then(function () {\n        inputStream.close();\n        outputStream.close();\n    });\n}\n</code></pre><br /><br /><p>A couple of notable differences:</p><br />\n<ol><br /><li><p>In the first implementation, we passed along some values via the closure (e.g., <code>inputStream</code> and <code>outputStream</code>). In the second, we had to declare them in the outer scope because there was no common closure.</p></li>\n<li><p>In the first implementation, we chained <code>targetFile.openAsync</code> and <code>sourceFile.getThumbnailAsync</code>, but we didn&#8217;t really need to. We made the real relationship more explicit in the second using <code>WinJS.Promise.join</code>. That mean the values of these two promises came to us in an arrays (we named it <code>args</code>).</p></li>\n</ol>\n<br />\n<h2>Summary</h2><br /><br /><p>Understanding how promises can be composed really helped us to make the code more readable. It can be difficult to wrap your head around the way they work, but (like it or not) promises are an essential part of writing apps with WinJS.</p><br />\n<h2>Fictitious Functions Implementations</h2><br /><br /><pre><code>// an example implementation of getRandomNumberAsync\n\nfunction getRandomNumberAsync() {\n    return WinJS.Promise.as(Math.random());\n}\n\n// an example implementation of getRandomNumberHigherThanAsync\n\nfunction getRandomNumberHigherThanAsync(minimum) {\n    var someNumber = Math.random() + minimum;\n    return WinJS.Promise.as(someNumber);\n}\n</code></pre><img src=\"http://feeds.feedburner.com/~r/ChristopherBennage/~4/ES71C4355Kk\" height=\"1\" width=\"1\"/></p></div><div class=\"entry\"><div class=\"title\"><a href=\"http://feedproxy.google.com/~r/ChristopherBennage/~3/qTCsQ3Qfel4/\">Unit Testing WinJS: First Steps</a></div><div class=\"moreinfo\"><span class=\"date\">Wednesday, August 15, 2012</span> &nbsp;|&nbsp; <span class=\"source\">From <a target=\"_blank\" href=\"http://feeds.feedburner.com/ChristopherBennage\">Christopher Bennage</a></span></div><p><p>N.B. <em>If you don&#8217;t know anything about WinJS, take a moment to peruse <a href=\"http://dev.bennage.com/blog/2012/08/01/a-brief-introduction-to-winjs/\">this primer</a>. Also, the context of this post is the <a href=\"http://hilojs.codeplex.com/\">p&amp;p Hilo project</a>.</em></p><br /><br /><p>One of the first questions we&#8217;ve been struggling with is how to best test a WinJS app.  (I&#8217;m going to use the term &#8220;unit test&#8221; somewhat loosely. Some of our tests would technically be classified as &#8220;integration tests&#8221;.)</p><br />\n<h2>Where to run the tests</h2><br /><br /><p>Our first barrier to unit testing a WinJS app was finding a convenient way to run the tests.<br />The primary difficulty is that the WinRT APIs are only available in the context of a Windows 8 app (and that&#8217;s also practicially the case for WinJS as well). So if your tests need to touch either one, the only choice you currently have is to run the tests inside a Windows 8 app.</p><br /><br /><p><img class=\"right\" src=\"http://dev.bennage.com/images/posts/winjs-test-solution.png\"></p><br /><br /><p>After some experimentation, we choose to include a second app in our solution to host the unit tests. (At one point, we had the tests embedded in the actual app itself; executing them with a hidden keyboard shortcut.) Having two apps means that we have to share the source that&#8217;s under test. Currently, we&#8217;re just <a href=\"http://msdn.microsoft.com/en-us/library/9f4t9t92.aspx\">manually linking the files</a>. I also have to manually go into the default.html and add references to the scripts. Ultimately, I&#8217;d like to have this automated, but that&#8217;s a task for another day.</p><br /><br /><p><em>Notice in the screen shot of the solution explorer, that the <code>Hilo</code> folder in the <code>Hilo.Specifications</code> project has a little red <strong>x</strong>. This is because the folder doesn&#8217;t physically exist there. Instead, there are just links to the corresponding files in the main <code>Hilo</code> project.</em></p><br />\n<h2>How to run the tests</h2><br /><br /><p>We settled on <a href=\"http://visionmedia.github.com/mocha/\">Mocha</a> for running our unit tests. Mocha is popular in the <a href=\"http://nodejs.org/\">Node.js</a> and it has (in my opinion) one of the better async test stories. This is really important when building Windows 8 apps because (much like Node.js) all the APIs are asynchronous.</p><br /><br /><p>We also choose to use a <a href=\"http://en.wikipedia.org/wiki/Behavior_Driven_Development\">BDD-style</a> for the tests. However, Mocha supports several styles, including a QUnit style.</p><br /><br /><p>Mocha will pass a function into your tests for you to call once the asynchronous work is complete. For example:</p><br /><br /><pre><code>it(test something asynchronous using a promise, function(done) {\n\n    doSomeWork().then(function(result){\n\n        if(!result) { // or whatever assertion is appropriate\n            throw new Error(test failed) \n        } else {\n            done(); // we call the function after the async work is complete\n        }\n\n    });\n});\n</code></pre><br /><br /><p>If you don&#8217;t understand the call to <code>then</code>, take a moment to read about <a href=\"http://msdn.microsoft.com/en-us/library/windows/apps/hh700330.aspx\">async programming in WinJS apps</a>.</p><br /><br /><p>What&#8217;s great about Mocha is that if you omit the <code>done</code> parameter, then the harness automagically assumes the test is synchronous. Very nice.</p><br /><br /><p>We did have <a href=\"https://github.com/visionmedia/mocha/issues/502\">one problem</a> with Mocha. It has an internal recursive process that can cause a stack overflow in IE. <a href=\"http://lostechies.com/derickbailey/\">Derick Bailey</a> came up with a quick workaround by reseting the stack before each test with a call to <code>setTimeout</code> in our <a href=\"http://hilojs.codeplex.com/SourceControl/changeset/view/13593c579fb6#Hilo.Specifications%2fspec.helpers.js\">test helper script</a>.</p><br /><br /><pre><code>beforeEach(function (done) {\n    setTimeout(done, 0);\n});\n</code></pre><br /><br /><p>As mentioned before, Mocha is primarly for Node. However Mocha&#8217;s creator <a href=\"http://tjholowaychuk.com/\">TJ Holowaychuk</a>, graciously allowed me to setup a <a href=\"http://nuget.org/packages/mochajs-browseronly\">Nuget package</a> to make it easier for Windows developers to use Mocha.</p><br />\n<h3>Steps to install Mocha</h3><br />\n<ol><br /><li>Right-click on the test project and select Manage Nuget Packages</li>\n<li>Seach for &#8220;mocha&#8221;</li>\n<li>Select &#8220;mocha for browsers&#8221; and click Install</li>\n<li>Open the default.html page and reference the scripts. They are located in the \\lib folder. (see below)</li>\n<li>Open the default.js file and add <code>mocha.run()</code> some where after app is ready.</li>\n</ol>\n<br /><br /><p>In my <a href=\"http://hilojs.codeplex.com/SourceControl/changeset/view/13593c579fb6#Hilo.Specifications%2fdefault.html\">default.html</a>:</p><br /><br /><pre><code>&lt;link rel=\"stylesheet\" type=\"text/css\" href=\"http://dev.bennage.com/lib/mocha.css\"&gt;\n&lt;script src=\"http://dev.bennage.com/lib/mocha.js\"&gt;&lt;/script&gt;\n &lt;! choose the style that you want for tests first &gt;\n&lt;script&gt;mocha.setup(bdd)&lt;/script&gt;\n\n&lt;! then reference your actual test script &gt;\n</code></pre><br /><br /><p>A simplified <a href=\"http://hilojs.codeplex.com/SourceControl/changeset/view/13593c579fb6#Hilo.Specifications%2fdefault.js\">default.js</a> might be:</p><br /><br /><pre><code>(function () {\n    use strict;\n\n    var activation = Windows.ApplicationModel.Activation,\n        app = WinJS.Application,\n        nav = WinJS.Navigation;\n\n    app.addEventListener(activated, function (args) {\n        if (args.detail.kind === activation.ActivationKind.launch) {\n            args.setPromise(WinJS.UI.processAll().then(function () {\n                mocha.run();\n            }));\n        }\n    }, false);\n\n    app.start();\n})(this);\n</code></pre><br />\n<h2>What to mock?</h2><br /><br /><p>The next big question was about making our code &#8220;testable&#8221;. I don&#8217;t like saying that because, in general, we don&#8217;t want test concerns to be bleed into the code. (I have some <a href=\"http://dev.bennage.com/blog/2008/03/30/the-roots-of-best-practices/\">personal principles</a> about these sorts of practices.)</p><br /><br /><p>At first, I tried to create a system that would completely mock out every WinRT API. I modeled it after <a href=\"http://www.commonjs.org/specs/modules/1.0/\">CommonJS Modules</a>. In essence, I made every &#8220;module&#8221; in my app use a <code>require</code> function to locate its dependencies. Using this approach you had to reference the WinRT API in the very unnatural form of:</p><br /><br /><pre><code>var knownFolders = require(Windows.Storage.KnownFolders); \n</code></pre><br /><br /><p>instead of the standard:</p><br /><br /><pre><code>var knownFolders = Windows.Storage.KnownFolders;\n</code></pre><br /><br /><p>This made it easy (ish) to mock out the WinRT call in my tests. However, there were a <a href=\"http://hilojs.codeplex.com/discussions/364538\">number</a> of <a href=\"http://hilojs.codeplex.com/discussions/366305\">negatives</a> to this approach. Mostly, it added an extra layers of complexity and it broke tooling (such as Intellisense and code navigation).</p><br /><br /><p>Instead, we decided to take a more <a href=\"http://dev.bennage.com/blog/2010/09/06/what-is-functional-programming/\">functional</a> approach to our code. As much as was reasonable, we tried to write our code as <em>functions with inputs</em> instead of as <em>objects with dependencies</em>. Then in our tests we could invoke the functions passing in &#8220;mocks&#8221; that were shaped like the necessary WinRT dependencies. This mean that we had thin layers in our app that invoked the functions and passed in the necessary bits. It also meant that in a few cases, we had to run tests against the actual WinRT objects. (Technically, I would call these &#8220;integration&#8221; tests instead of &#8220;unit&#8221; tests).</p><br /><br /><p>The best example of this approach in the HiloJS project (so far) can be found in <a href=\"http://hilojs.codeplex.com/SourceControl/changeset/view/13593c579fb6#Hilo%2fHilo%2fTiles%2ftileUpdater.js\">tileUdater.js</a>. In that file, we create a simple object that coordinates the real work using a set of functions. The major functions are defined in their own files (all inside the \\Hilo\\Tiles folder). We &#8220;export&#8221; these functions using <a href=\"http://msdn.microsoft.com/en-us/library/windows/apps/br212667.aspx\"><code>WinJS.Namespace.define</code></a>. Exporting them makes them available to the code in tileUpdater.js as well as our tests.</p><br />\n<h2>Summary</h2><br /><br /><p>So far this arrangement has worked really well for us. Working with Mocha has been a lot of fun. The test authoring experience isn&#8217;t quite as smooth as I&#8217;d like, but I&#8217;m sure that will come as we gain more experience.<br />Remember though, this project is very much a journey, so keep on eye on the <a href=\"http://hilojs.codeplex.com/\">project site</a>. We&#8217;ll be writing more about it as we learn.</p><br /><br /><p>As always, your feedback is greatly desired. Do you have a better way? How does this approach strike? Feel free to speak up our the <a href=\"http://hilojs.codeplex.com/discussions\">project&#8217;s discussion board</a>.</p><img src=\"http://feeds.feedburner.com/~r/ChristopherBennage/~4/qTCsQ3Qfel4\" height=\"1\" width=\"1\"/></p></div><div class=\"entry\"><div class=\"title\"><a href=\"http://feedproxy.google.com/~r/ChristopherBennage/~3/dZE_JSKtSRk/\">A Brief Introduction to WinJS</a></div><div class=\"moreinfo\"><span class=\"date\">Wednesday, August 01, 2012</span> &nbsp;|&nbsp; <span class=\"source\">From <a target=\"_blank\" href=\"http://feeds.feedburner.com/ChristopherBennage\">Christopher Bennage</a></span></div><p><p>I&#8217;m a few weeks into my <a href=\"http://hilojs.codeplex.com/\">latest p&amp;p project</a>. We&#8217;re exploring how to build Windows 8 applications with HTML and JavaScript. I&#8217;ll refer to these apps as &#8220;WinJS apps&#8221;.</p><br /><br /><p>This post is a very brief overview and introduction to some terminology related to WinJS. It&#8217;s my personal take and it&#8217;s certainly not official. All of the official documentation can be found at the <a href=\"http://msdn.microsoft.com/windows/apps/\">Dev Center</a>.</p><br />\n<h2>What is a WinJS app?</h2><br /><br /><p>In my recent expereince there is often some confusion about Windows 8 apps in general, so let&#8217;s begin there.</p><br /><br /><p>Windows 8 apps are similar to what you would find on Windows Phone, iOS, or Android, in that they are sandboxed and they have to declare to user when they use more <em>advanced</em> APIs (like location awareness for example). The only way for users to get Windows 8 apps is through the <a href=\"http://msdn.microsoft.com/library/windows/apps/br230836\">store</a>.</p><br /><br /><p>Windows 8 apps can be built with C++ and XAML, C#/VB.NET and XAML, and JavaScript and HTML. All three choices have access to the <a href=\"http://msdn.microsoft.com/en-US/library/windows/apps/br211377\">Windows Runtime</a>. It&#8217;s the consolidated API was interacting with the OS.</p><br /><br /><p>When using JavaScript, the Windows Runtime is available as the global object <code>Windows</code>.</p><br /><br /><p>In addition to the Windows Runtime (which I sometimes personally call WinRT), there is the <em>Windows Library for JavaScript</em> or <em>WinJS</em>. This is different from WinRT. It&#8217;s pure JavaScript and only availabe to JavaScript apps. It&#8217;s automatically referenced when you create a new project. It is available as the global object <code>WinJS</code>.</p><br /><br /><p>WinJS includes lots of helpful bits:</p><br />\n<ul><br /><li>an implementation of <a href=\"http://wiki.commonjs.org/wiki/Promises/A\">CommonJS Promises/A</a>.</li>\n<li>some advanced UI controls</li>\n<li>DOM utilities</li>\n<li>navigation and xhr helpers</li>\n<li>and more</li>\n</ul>\n<br /><br /><p>Technically, you don&#8217;t <em>have</em> to use WinJS. If you wanted to, you could ignore it. In practice though, it can be pretty useful.</p><br /><br /><p>Finally, you can develop with standards-based HTML, CSS, and JavaScript without worrying about cross-browser issues. For example, I haven&#8217;t felt the need for jQuery because I can just use <a href=\"http://www.w3.org/TR/selectors-api/\"><code>document.querySelector</code></a> without fear.</p><br /><br /><p>Likewise, don&#8217;t go looking through WinJS for standard controls; just use the native HTML controls that you already know and love.</p><img src=\"http://feeds.feedburner.com/~r/ChristopherBennage/~4/dZE_JSKtSRk\" height=\"1\" width=\"1\"/></p></div><div class=\"entry\"><div class=\"title\"><a href=\"http://feedproxy.google.com/~r/ChristopherBennage/~3/G-MvrkfFIw8/\">Render Action</a></div><div class=\"moreinfo\"><span class=\"date\">Friday, April 27, 2012</span> &nbsp;|&nbsp; <span class=\"source\">From <a target=\"_blank\" href=\"http://feeds.feedburner.com/ChristopherBennage\">Christopher Bennage</a></span></div><p><p>It&#8217;s common for a single web page to include data from many sources. Consider this screen shot from <a href=\"http://silk.codeplex.com/\">Project Silk</a>. There are four separate items displayed.</p><br /><br /><p><img class=\"right\" src=\"http://dev.bennage.com/images/posts/many-concerns.png\"></p><br /><br /><p>The primary concern of the page is displaying a list of vehicles. However it also displays some statistics and a set of reminders. I labeled the stats and reminders as orthogonal because they are (in a sense) independent of the primary concern. Finally, there is the ambient data of the currently logged in user. I call this data ambient because we expect it to be present on all the pages in the application.</p><br /><br /><p>It&#8217;s a common practice in MVC-style applications to map a single controller action to a view. That is, it is the responsibility of a single action to produce everything that is needed to render a particular web page.</p><br /><br /><p>The difficulty with this approach is that <em>other pages</em> often need to render the same orthogonal data. Let&#8217;s examine the code for the action invoked by <code>\\vehicle\\list</code>.</p><br /><br /><pre><code>public ActionResult List()\n{\n    AddCountryListToViewBag();\n\n    var vehicles = Using&lt;GetVehicleListForUser&gt;()\n        .Execute(CurrentUserId);\n\n    var imminentReminders = Using&lt;GetImminentRemindersForUser&gt;()\n        .Execute(CurrentUserId, DateTime.UtcNow);\n\n    var statistics = Using&lt;GetFleetSummaryStatistics&gt;()\n        .Execute(CurrentUserId);\n\n    var model = new DashboardViewModel\n                    {\n                        User = CurrentUser,\n                        VehicleListViewModel = new VehicleListViewModel(vehicles),\n                        ImminentReminders = imminentReminders,\n                        FleetSummaryStatistics = statistics\n                    };\n\n    return View(model);\n}\n</code></pre><br /><br /><p>Disregarding how you might feel about the <code>Using&lt;T&gt;</code> method to invoke commands and other such details, I want you to focus on the fact that the controller is <em>composing</em> a model. We generate a number of smaller viewmodels and then compose them into an instance of <code>DashboardViewModel</code>. The class <code>DashboardViewModel</code> only exists to tie together the four, otherwise independent data.</p><br /><br /><p><aside></p><br /><br /><p>Personally, I prefer to avoid classes like <code>DashboardViewModel</code> and simply rely on dynamic typing in the view. However, others feel strongly about having IntelliSense support in the view.</p><br /><br /><p></aside></p><br /><br /><p>Project Silk had separate actions just to serve up JSON:</p><br /><br /><pre><code>public JsonResult JsonList()\n    {\n        var list = Using&lt;GetVehicleListForUser&gt;()\n            .Execute(CurrentUserId)\n            .Select(x =&gt; ToJsonVehicleViewModel(x))\n            .ToList();\n\n        return Json(list);\n    }\n</code></pre><br /><br /><p>You&#8217;ll notice that both <code>JsonList</code> and <code>List</code> use the same <code>GetVehicleListForUser</code> command for retrieving their data. <code>JsonList</code> also projected the data to a slightly different viewmodel.</p><br />\n<h2>Reducing the Code</h2><br /><br /><p>While reevaluating this code for <a href=\"https://github.com/liike/\">Project Liike</a>, we decided to employ <a href=\"http://en.wikipedia.org/wiki/Content_negotiation\">content negotiation</a>. That is, we wanted a single endpoint, such as <code>\\vehicle\\list</code>, to return different representations of the data based upon a requested format. If the browser requested JSON, then <code>\\vehicle\\list</code> should return a list of the vehicles in JSON. If the browser requested markup, then the same endpoint should return HTML.</p><br /><br /><p>First, we needed to eliminate the differences between the JSON viewmodel and the HTML viewmodel. Without going deep into details, this wasn&#8217;t hard to do. In fact, it revealed that we had some presentation logic in the view that should not have been there. The real problem was that I wanted the action to look more like this:</p><br /><br /><pre><code>public ActionResult List()\n{\n    var vehicles = Using&lt;GetVehicleListForUser&gt;()\n        .Execute(CurrentUserId);\n\n    return new ContentTypeAwareResult(vehicles);\n}\n</code></pre><br /><br /><p>Only, the view still needed the additional data of statistics and reminders. How should the view get it?</p><br /><br /><p>We decided to use <a href=\"http://msdn.microsoft.com/en-us/library/system.web.mvc.html.childactionextensions.renderaction.aspx\">RenderAction</a>. RenderAction allows a view to invoke another action and render the results into the current view.</p><br /><br /><p>We needed to break out the other concerns into their own actions. For the sake of example, we&#8217;ll assume they are both on the <code>VehicleController</code> and named <code>Reminders</code> and <code>Statistics</code>. Each of these action would be responsible for getting a focused set of data. Then in the (imaginary) view for <code>List</code> we could invoke the actions like so:</p><br /><br /><pre><code>// List.cshtml \n&lt;ul&gt;\n@foreach (var vehicle in Model)\n{\n    &lt;li&gt;@vehicle.Name&lt;/li&gt;\n}\n&lt;/ul&gt;\n\n&lt;section role=\"reminders\"&gt;\n@{ Html.RenderAction( \"Reminders\", \"Vehicle\") }\n&lt;/section&gt;\n\n&lt;section role=\"statistics\"&gt;\n@{ Html.RenderAction( \"Statistics\", \"Vehicle\") }\n&lt;/section&gt;\n</code></pre><br /><br /><p><aside></p><br /><br /><p>Note that each action has it&#8217;s on associated view.</p><br /><br /><p></aside></p><br /><br /><p>The value of using RenderAction is that we where able to create very simple actions on our controllers. We were also able to reuse the actions for rendering both markup and JSON.</p><br /><br /><p>A secondary benefit is the separation of concerns. For example, because we moved the responsibility of composition from the controller into the view, a designer could now revise the view for the <code>\\vehicle\\list</code> without needing to touch the code. They could remove any of the orthogonal concerns or even add new ones without introducing any breaking changes.</p><br />\n<h2>The Downside</h2><br /><br /><p>There are a few caveats with this approach.</p><br /><br /><p>First, don&#8217;t confuse RenderAction with <a href=\"http://msdn.microsoft.com/en-us/library/system.web.mvc.html.renderpartialextensions.renderpartial.aspx\">RenderPartial</a>. RenderAction is for invoking a completely independent action, with its own view and model. RenderPartial is simply for renders a view based on a model passed to it (generally derived from the main viewmodel).</p><br /><br /><p>Secondly, avoid using RenderAction to render a form. It&#8217;s likely won&#8217;t work the way you&#8217;d expect.This means that any form rendering will need to occur in your primary view.</p><br /><br /><p>Thirdly, using RenderAction breaks the <a href=\"http://en.wikipedia.org/wiki/Model-view-controller#Overview\">model-view-controller</a> pattern. What I mean is that, in MVC, it&#8217;s assumed that the view does nothing more than render a model. Controllers invoke a view, and not vice versa. Using RenderAction breaks this rule. Personally, I have no problem breaking the rule when it results in code that is more simple and more easily maintained. Isn&#8217;t that the whole <a href=\"http://dev.bennage.com/blog/2008/03/30/the-roots-of-best-practices/\">point of best practices</a> anyway?</p><img src=\"http://feeds.feedburner.com/~r/ChristopherBennage/~4/G-MvrkfFIw8\" height=\"1\" width=\"1\"/></p></div><div class=\"entry\"><div class=\"title\"><a href=\"http://feedproxy.google.com/~r/ChristopherBennage/~3/0vHRXzOj5gY/\">Finding Out When Something Happened in Your Git Repo</a></div><div class=\"moreinfo\"><span class=\"date\">Tuesday, February 07, 2012</span> &nbsp;|&nbsp; <span class=\"source\">From <a target=\"_blank\" href=\"http://feeds.feedburner.com/ChristopherBennage\">Christopher Bennage</a></span></div><p><p><em>Acknowledgment: This is meant to be the Windows equivalent of <a href=\"http://blog.jayway.com/author/andersjanmyr\">Anders Janmyr</a>&#8217;s <a href=\"http://blog.jayway.com/2012/01/25/finding-with-git/\">excellent post</a> on the subject of finding stuff with Git. Essentially, I&#8217;m translating some of Anders&#8217; examples to Powershell and providing explanations for things that many Windows devs might not be familiar with.</em></p><br /><br /><p>This is the third in a series of posts providing a set of recipes for locating sundry and diverse <em>thingies</em> in a Git repository.</p><br />\n<h2>Determining when a file was added, deleted, modified, or renamed</h2><br /><br /><p>You can include the <code>diff-filter</code> argument with <code>git log</code> to find commits that include specific operations. For example:</p><br /><br /><pre><code>git log diff-filter=D # delete\ngit log diff-filter=A # add\ngit log diff-filter=M # modified\ngit log diff-filter=R # rename\n</code></pre><br /><br /><p>There are additional flags as well. Check the <a href=\"http://schacon.github.com/git/git-log.html\">documentation</a>. By default, <code>git log</code> just returns the commit id, author, date, and message. When using these filters I like to include <code>summary</code> so that the list of operations in the commit are included as well.</p><br /><br /><p><em>N.B. If you run a <code>git log</code> command and your prompt turns into a <code>:</code> simply press <code>q</code> to exit.</em></p><br /><br /><p>I don&#8217;t think that you would ever want to return <em>all</em> of the operations of a specific type in the log however. Instead, you will probably want to find out when a specific file was operated on.</p><br /><br /><p>Let&#8217;s say that something was deleted and you need to find out when and by whom. You can pass a path to <code>git log</code>, though you&#8217;ll need to preced it with <code></code> and a space to disambiguate it from other arguments. Armed with this and following Ander&#8217;s post you would expect to be able to do this:</p><br /><br /><pre><code>git log diff-filter=D summary  /path/to/deleted/file\n</code></pre><br /><br /><p>And if you aren&#8217;t using Powershell this works as expected. I tested it with Git Bash (included with msysgit) and good ol&#8217; cmd as well. Both work as expected.</p><br /><br /><p>However, when you attempt this in Powershell, git complains that the path is an <em>ambiguous arugment</em>. I was able to, um, &#8220;work around&#8221; it by creating an empty placeholder file at the location.  Fortunately, <a href=\"https://twitter.com/#!/Jittery\">Jay Hill</a> heard my anguish on Twitter and dug up <a href=\"http://blogs.popart.com/2011/11/command-line-git-and-windows-gotchas/\">this post</a> from <a href=\"http://blogs.popart.com/author/ethanbrown/\">Ethan Brown</a>. In a nutshell, Powershell strips out the <code></code>. You can force it to be recognized by wrapping the argument in double qoutes:</p><br /><br /><pre><code>git log diff-filter=D summary \"\" /path/to/deleted/file\n</code></pre><br /><br /><p>That works!</p><br /><br /><p>I&#8217;m guessing that Powershell considers <code></code> to be an empty arugment and therefore something to be ignored. I also assume that when the file actually exists at the path that git is smart enough to recognize the argument as a path. (Indeed, the official documentations says that &#8220;paths <em>may</em> need to be prefixed&#8221;).</p><br /><br /><p>While we&#8217;re here, I also want to point out that you can use wild cards in the path. Perhaps you don&#8217;t know the exact path to the file, but you know that it was named <code>monkey.js</code>:</p><br /><br /><pre><code>git log diff-filter=D summary  **/monkey.js\n</code></pre><br /><br /><p>Happy hunting!</p><img src=\"http://feeds.feedburner.com/~r/ChristopherBennage/~4/0vHRXzOj5gY\" height=\"1\" width=\"1\"/></p></div><div class=\"entry\"><div class=\"title\"><a href=\"http://feedproxy.google.com/~r/ChristopherBennage/~3/_dpuj8JqbBM/\">Finding Content in Files with Git</a></div><div class=\"moreinfo\"><span class=\"date\">Wednesday, February 01, 2012</span> &nbsp;|&nbsp; <span class=\"source\">From <a target=\"_blank\" href=\"http://feeds.feedburner.com/ChristopherBennage\">Christopher Bennage</a></span></div><p><p><em>Acknowledgment: This is meant to be the Windows equivalent of <a href=\"http://blog.jayway.com/author/andersjanmyr\">Anders Janmyr</a>&#8217;s <a href=\"http://blog.jayway.com/2012/01/25/finding-with-git/\">excellent post</a> on the subject of finding stuff with Git. Essentially, I&#8217;m translating some of Anders&#8217; examples to Powershell and providing explanations for things that many Windows devs might not be familiar with.</em></p><br /><br /><p>This is the second in a series of posts providing a set of recipes for locating sundry and diverse <em>thingies</em> in a Git repository.</p><br />\n<h2>Finding content in files</h2><br /><br /><p>Let&#8217;s say that there are hidden monkeys inside your files and you need to find. You can search <em>the content</em> of files in a Git repositor by using <code>git grep</code>. (For all you Windows devs, <a href=\"http://en.wikipedia.org/wiki/Grep\"><code>grep</code></a> is a kind of magical pony from Unixland whose special talent is finding things.)</p><br /><br /><pre><code># find all files whose content contains the string monkey\nPS:\\&gt; git grep monkey\n</code></pre><br /><br /><p>There several arguments you can pass to grep to modify the behavior. These special arguments make the pony do different tricks.</p><br /><br /><pre><code># return the line number where the match was found\nPS:\\&gt; git grep -n monkey\n\n# return just the file names\nPS:\\&gt; git grep -l monkey\n\n# count the number of matches in each file\nPS:\\&gt; git grep -c monkey\n</code></pre><br /><br /><p>You can pass an arbitrary number of <em>references</em> after the pattern you&#8217;re trying to match. By <em>reference</em> I mean something that&#8217;s <em>commit-ish</em>. That is, it can be the id (or SHA) of a commit, the name of a branch, a tag, or one of the special identifier like HEAD.</p><br /><br /><pre><code># search the master branch, and two commits by id, \n# and also the commit two before the HEAD\nPS:\\&gt; git grep monkey master d0fb0d 032086 HEAD~2\n</code></pre><br /><br /><p>The SHA is the 40-digit id of a commit. We only need enough of the SHA for Git to uniquely identify the commit. Six or eight characters is generally enough.</p><br /><br /><p>Here&#8217;s an example using the <a href=\"https://github.com/ravendb/ravendb\">RavenDB repo</a>.</p><br /><br /><pre><code>PS:\\&gt; git grep -n monkey master f45c08bb8 HEAD~2\n\nmaster:Raven.Tests/Storage/CreateIndexes.cs:83:         db.PutIndex(\"monkey\", new IndexDefinition { Map = unimportantIndexMap });\nmaster:Raven.Tests/Storage/CreateIndexes.cs:90:         Assert.Equal(\"monkey\", indexNames[1]);\nf45c08bb8:Raven.Tests/Storage/CreateIndexes.cs:82:          db.PutIndex(\"monkey\", new IndexDefinition { Map = unimportantIndexMap });\nf45c08bb8:Raven.Tests/Storage/CreateIndexes.cs:89:          Assert.Equal(\"monkey\", indexNames[1]);\nHEAD~2:Raven.Tests/Storage/CreateIndexes.cs:83:         db.PutIndex(\"monkey\", new IndexDefinition { Map = unimportantIndexMap });\nHEAD~2:Raven.Tests/Storage/CreateIndexes.cs:90:         Assert.Equal(\"monkey\", indexNames[1]);\n</code></pre><br /><br /><p>Notice that each line begins with the name of the commit where the match was found. In the example above where we asked for the line numbers, the results were in the pattern:</p><br /><br /><pre><code>[commit ref]:[file path]:[line no]:[matching content]\n</code></pre><br /><br /><p><em>N.B. I had one repository that did not work with <code>git grep</code>. It was because my &#8216;text&#8217; files were encoded UTF-16 and git interpretted them as binary. I converted them to UTF-8 and the world became a happy place.</em></p><br />\n<h2>References</h2><br />\n<ul><br /><li><a href=\"http://en.wikipedia.org/wiki/Grep\">grep</a></li>\n<li><a href=\"http://book.git-scm.com/1_the_git_object_model.html\">SHA</a> (just the first paragraph)</li>\n<li><a href=\"http://book.git-scm.com/4_git_treeishes.html\">ways of referencing commits</a></li>\n</ul><img src=\"http://feeds.feedburner.com/~r/ChristopherBennage/~4/_dpuj8JqbBM\" height=\"1\" width=\"1\"/></p></div><div class=\"entry\"><div class=\"title\"><a href=\"http://feedproxy.google.com/~r/ChristopherBennage/~3/yRmXnElHTLc/\">Finding Files by Name with Git</a></div><div class=\"moreinfo\"><span class=\"date\">Sunday, January 29, 2012</span> &nbsp;|&nbsp; <span class=\"source\">From <a target=\"_blank\" href=\"http://feeds.feedburner.com/ChristopherBennage\">Christopher Bennage</a></span></div><p><p><em>Acknowledgment: This is meant to be the Windows equivalent of <a href=\"http://blog.jayway.com/author/andersjanmyr\">Anders Janmyr</a>&#8217;s <a href=\"http://blog.jayway.com/2012/01/25/finding-with-git/\">excellent post</a> on the subject of finding stuff with Git. Essentially, I&#8217;m translating some of Anders&#8217; examples to Powershell and providing explanations for things that many Windows devs might not be familiar with.</em></p><br /><br /><p>This is the first in a series of posts providing a set of recipes for locating sundry and diverse <em>thingies</em> in a Git repository.</p><br />\n<h2>Finding files by name</h2><br /><br /><p>Let&#8217;s say that you want locate all the files in a git repository that contain &#8216;monkey&#8217; in the file name. (Finding monkeys is a very common task.)</p><br /><br /><pre><code># find all files whose name matches monkey\nPS:\\&gt; git ls-files | Select-String monkey\n</code></pre><br /><br /><p>This <em>pipes</em> the output of <code>git ls-files</code> into the Powershell cmdlet <code>Select-String</code> which filters the output line-by-line. To better understand what this means, run just <code>git ls-files</code>.</p><br /><br /><p>Of course, you can also pass a regular expression to<code>Select-String</code> (that is, if you hate yourself.)</p><br />\n<h2>References</h2><br />\n<ul><br /><li><a href=\"http://schacon.github.com/git/git-ls-files.html\">git ls-files</a></li>\n<li><a href=\"http://technet.microsoft.com/en-us/library/dd315403.aspx\">Select-String</a></li>\n<li><a href=\"http://technet.microsoft.com/en-us/library/ee176927.aspx\">the pipe operator <code>|</code></a></li>\n<li><a href=\"http://haacked.com/archive/2011/12/13/better-git-with-powershell.aspx\">Better Git with Powershell by Phil Haack</a></li>\n</ul>\n<br /><br /><!<br />[Next, searching for files with specific content.](/blog/2012/02/01/finding-stuff-in-your-git-repo-2/)<br />><img src=\"http://feeds.feedburner.com/~r/ChristopherBennage/~4/yRmXnElHTLc\" height=\"1\" width=\"1\"/></p></div><div class=\"entry\"><div class=\"title\"><a href=\"http://feedproxy.google.com/~r/ChristopherBennage/~3/WxedB80ZOyE/\">On Not Being a Jerk</a></div><div class=\"moreinfo\"><span class=\"date\">Monday, January 09, 2012</span> &nbsp;|&nbsp; <span class=\"source\">From <a target=\"_blank\" href=\"http://feeds.feedburner.com/ChristopherBennage\">Christopher Bennage</a></span></div><p><p>My interest in making software well is an accident. What I&#8217;m really interested in is <em>living life</em> well. Chasing that chimerical beast of software &#8220;best practices&#8221; is merely a happy side-effect.</p><br /><br /><p>To that end, there&#8217;s an ancient maxim: <a href=\"http://en.wikipedia.org/wiki/Know_thyself\">&#8216;know thyself&#8217;</a>. Despite over three decades of living with myself, I am often surprised by what I do. Surprised, and many times embarassed.</p><br /><br /><p>For example, last week I complained on twitter about what I had perceived as selfish and inconsiderate behavior of some of my fellow employees. It was quickly pointed out to me that I was wrong; that I was completely misinterpreting my observations.</p><br /><br /><p>Once I realized my mistake, my immediate thought was &#8220;Oh, I don&#8217;t want people to think that I&#8217;m a jerk. I wish I hadn&#8217;t said that&#8221;. Shortly afterwards though, I realized that I had been more concerned about what <em>other people thought</em> and not my real problem. The real problem was that I <em>was</em> a jerk. I had judged people I did not know with only scant evidence. This reminded me of another ancient maxim: <a href=\"ttp://www.biblegateway.com/passage/?search=Matthew+7%3A1\">&#8220;judge not, that ye be not judged&#8221;</a>.</p><br /><br /><p>Now, here is the surpising conclusion. I&#8217;m glad that I stated my faulty opinion out loud, despite that it embarassed me, because it revealed my fault and I had to correct it. I had to confront my own prejudice and fix it. If I had kept the venom to myself, I would have gone on nursing my prejudice.</p><br /><br /><p>My take away: it doesn&#8217;t matter what people think about me, it matters what I am. It is better for me to surface my flaws and fix them, than it is for me to hide them and decay.</p><img src=\"http://feeds.feedburner.com/~r/ChristopherBennage/~4/WxedB80ZOyE\" height=\"1\" width=\"1\"/></p></div><div class=\"entry\"><div class=\"title\"><a href=\"http://feedproxy.google.com/~r/ChristopherBennage/~3/HFPv1kA5zIA/\">Refactoring Relationships</a></div><div class=\"moreinfo\"><span class=\"date\">Tuesday, November 01, 2011</span> &nbsp;|&nbsp; <span class=\"source\">From <a target=\"_blank\" href=\"http://feeds.feedburner.com/ChristopherBennage\">Christopher Bennage</a></span></div><p><p>Working with people is a lot like working with code. New relationships are green fields. Over time they become brown fields and (just like code) they require maintenance. Im sure that everyone reading this can identify some <em>legacy</em> relationships that they would describe as well <em>complicated</em>. Just like some legacy code.</p><br /><br /><! more ><br /><br /><br /><p>I mean a lot with the word relationship. I have in mind everything from co-workers to friends to significant others. All of these variations require maintenance and I think we should deliberately structure our relationships so that maintenance is easier.</p><br />\n<h2>Interaction Smells</h2><br /><br /><p><img class=\"right\" src=\"http://dev.bennage.com/images/posts/rowing.jpg\"></p><br /><br /><p>So what is the social equivalent of a switch\\case statement?</p><br /><br /><p>We talk about <a href=\"http://en.wikipedia.org/wiki/Code_smell\">code smells</a> in software development as suggestive indicators that something is wrong. When it comes to relationships, I&#8217;ll call them <em>interaction smells</em>. I would consider these common emotional responses to be smells:</p><br />\n<ul><br /><li>avoidance</li>\n<li>irritation</li>\n<li>suspicion</li>\n</ul>\n<br /><br /><p>Personally, I have been guilty of avoiding someone because I thought I would irritate them and I didnt want the hassle. This was in a work environment and it a negative effect on the overall efficacy of the group. My <em>impulse to avoid</em> was a smell and it led to a problem that needed to be addressed.</p><br />\n<h2>Amicability Debt</h2><br /><br /><p>Bad code gets worse over time. We call this <a href=\"http://martinfowler.com/bliki/TechnicalDebt.html\">technical debt</a>. Relationships that have soured do not get better by themselves. Little fractures grow over time. If we dont address them when we smell them, the stink only gets worse. In addition, the stinky relationship can be begin affecting other parts of design, uh I mean, other social interactions (e.g., the team you are working with).</p><br />\n<h2>Refactoring the Relationship</h2><br /><br /><p>Relationships are more difficult to work with than code for one primary reason:</p><br /><br /><p><em>You cannot revert back to a previous state if your changes fail.</em></p><br /><br /><p>Nevertheless, we often <em>need</em> to make changes. Refactoring code doesnt change the exposed functionality, we just make internal changes to improve it. If you are beginning to have problems with your boss, that doesnt necessarily mean its time to quit (that would be changing the function) rather you might just need some relational refactoring.</p><br /><br /><p>But what do I mean by refactoring a relationship? Well, theres a lot to be said and you can find a good deal of practical advice on dealing with conflict over on <a href=\"http://www.stevenlist.com/blog/\">Doc Lists blog</a>.</p><br /><br /><p>In brief though, I mean this:</p><br /><br /><p>Be honest and humble. Hey, Joe, I feel like youve been a bit on edge with me. Did I do something to frustrate you? Id like to clear the air. Then talk it over. Again, refer to Docs blog for lots of details.</p><br /><br /><p>One final qualification, since you cannot revert what you say and do, you must be deliberate and thoughtful about your refactoring.</p><br /><br /><p><em>This was originally posted this in August 2009, but I needed a reminder myself so&hellip;</em></p><img src=\"http://feeds.feedburner.com/~r/ChristopherBennage/~4/HFPv1kA5zIA\" height=\"1\" width=\"1\"/></p></div><div class=\"entry\"><div class=\"title\"><a href=\"http://feedproxy.google.com/~r/ChristopherBennage/~3/72mxw3vgX_Q/\">Getting Started with JavaScript again</a></div><div class=\"moreinfo\"><span class=\"date\">Thursday, October 27, 2011</span> &nbsp;|&nbsp; <span class=\"source\">From <a target=\"_blank\" href=\"http://feeds.feedburner.com/ChristopherBennage\">Christopher Bennage</a></span></div><p><p>I&#8217;ve alluded before that I did a large chunk of my development in some form of <a href=\"http://en.wikipedia.org/wiki/ECMAScript\">ECMAScript</a> for the first ten years of my professional life. Now, JavaScript is cool again for the first time. Everyone wants to learn it.</p><br /><br /><p>So, like me, you probably already kinda maybe knew JavaScript. But times have changed and now it&#8217;s a serious language. How do you get up to speed? Here&#8217;s what I did.</p><br />\n<h2>Read Some Books</h2><br />\n<h3><a href=\"http://eloquentjavascript.net/\">Eloquent JavaScript</a></h3><br /><br /><p>This is probably the best book to start with if you are <em>really</em> rusty (which also includes plain ol&#8217; <em>new</em> as well). Personally, I found the book a bit tedious and I didn&#8217;t quite finish.</p><br /><br /><p>Did I mention that it&#8217;s free?</p><br />\n<h3><a href=\"http://shop.oreilly.com/product/9780596517748.do\">JavaScript: The Good Parts</a></h3><br /><br /><p>An essential read for modern JavaScript development. It&#8217;s short and terse and easy to read. Douglas Crockford is highly regarded, though he can get occasionally <a href=\"http://anton.kovalyov.net/2011/02/20/why-i-forked-jslint-to-jshint/\">harsh some mellow</a>. He&#8217;s the <strike>supreme overlord</strike> author of <a href=\"http://jslint.com/\">JSlint</a>, a nifty tool that&#8217;s useful for detecting the <em>not so good</em> parts in your own JavaScript. The information in this book is foundational and I recommend reading it soon.</p><br />\n<h3><a href=\"http://shop.oreilly.com/product/9780596806767.do\">JavaScript Patterns</a></h3><br /><br /><p>This book is awesome. Seriously. Someone should give <a href=\"http://twitter.com/#!/stoyanstefanov\">Stoyan</a> a trophy. It deals with higher level patterns in your JavaScript applications. Be sure to read it after you become comfortable with core language concepts.</p><br />\n<h3><a href=\"http://shop.oreilly.com/product/9780596802806.do\">High Performance JavaScript</a></h3><br /><br /><p>I haven&#8217;t actually read this one yet, but it&#8217;s on my list. I have however heard <a href=\"http://twitter.com/#!/slicknet\">Nicholas C. Zakas</a> speak and from that I suspect that the content will be excellent.</p><br />\n<h2>Staying in Touch</h2><br /><br /><p>I&#8217;ve found it a little difficult to stay abreast of what&#8217;s having in the JavaSCript community.</p><br />\n<h3><a href=\"http://javascriptweekly.com/\">JavaScript Weekly</a></h3><br /><br /><p>The weekly podcast and its associated newsletter have been excellent. Highly recommended.</p><br />\n<h3>On the Interwebz</h3><br /><br /><p>Start with <a href=\"http://www.elijahmanor.com/\">Elijah Manor</a>. Aside from just being a good guy, Elijah is a perpetual fountain of information. So, you&#8217;ll want to <a href=\"http://twitter.com/#!/elijahmanor\">follow him</a> on Twitter. <em>Caveat: Following Elijah is drinking from a firehouse.</em></p><br /><br /><p>I also recommend:</p><br />\n<ul><br /><li><a href=\"http://twitter.com/#!/mattpodwysocki\">Matthew Podwysocki</a> A fellow &#8216;softie who is aware of all things JavaScripty.</li>\n<li><a href=\"http://twitter.com/#!/stoyanstefanov\">Stoyan Stefanov</a> from Yahoo</li>\n<li><a href=\"http://twitter.com/#!/jeresig\">John Resig</a> of jQuery fame</li>\n<li><a href=\"http://twitter.com/#!/slicknet\">Nicholas C. Zakas</a></li>\n<li><a href=\"http://twitter.com/#!/reybango\">Rey Bango</a></li>\n<li><a href=\"http://msdn.microsoft.com/en-us/scriptjunkie/default.aspx\">script junkies {}</a></li>\n</ul>\n<br /><br /><p> I&#8217;m sure there are many other resources. Please add additional ones in the comments.</p><br />\n<h2>Some Thoughts</h2><br /><br /><p>Here&#8217;s a few thoughts about learning JavaScript. Take them or leave them, but these are my current opinions.</p><br />\n<h3>Prototypes, not classes</h3><br /><br /><p>JavaScript is not a classical language (that&#8217;s fancy talk for &#8216;class based&#8217; language). Sometimes it looks classical, and may even taste a little classical, but really it&#8217;s not. Don&#8217;t try to force it. I think you&#8217;ll be happier and you&#8217;ll write <a href=\"http://bobross.com/\">happy little functions</a> if you embrace it&#8217;s prototypical nature. If you don&#8217;t understand the difference, that&#8217;s okay. You will after reading the books I listed above.</p><br />\n<h3>Don&#8217;t confuse the language and the environment</h3><br /><br /><p>We mostly know JavaScript through browser development. As such, we&#8217;ve generally confused the inside evil of the <a href=\"http://www.w3.org/DOM/\">DOM</a> with JavaScript itself. Or at least we did before jQuery rescued us.</p><br /><br /><p>However the browser isn&#8217;t the only environment. For the troglodytes amongst us, you can use <a href=\"http://nodejs.org/\">Node.js</a> and write JavaScript on the server.</p><br />\n<h3>Leverage the natural strengths</h3><br /><br /><p>Each of these concepts deserves a post (or more) on their own, so I won&#8217;t go into details.</p><br />\n<ul><br /><li>It&#8217;s a <em>dynamic</em> language. JavaScript is squishy and that&#8217;s good.</li>\n<li>It has many <a href=\"http://dev.bennage.com/blog/2010/09/06/what-is-functional-programming/\"><em>functional</em></a> characteristics.</li>\n<li>It favors <a href=\"http://msdn.microsoft.com/en-us/library/windows/apps/hh464930%28v=VS.85%29.aspx\"><em>asynchronous patterns</em></a>.</li>\n</ul>\n<br />\n<h3>K.I.S.S.</h3><br /><br /><p>Don&#8217;t mix trying to learn JavaScript with trying to learn a framework or library. My initial attempt to learn Ruby was thwarted by Rails. I know that some folks will disagree with me on this point. Here are my reasons:</p><br />\n<ul><br /><li>It&#8217;s likely that you&#8217;ll encounter many new concepts <em>just learning</em> the language.</li>\n<li>Sometimes it&#8217;s difficult to discern between a language feature and a framework feature.</li>\n<li>Many frameworks embody an opinions that can (unintentionally) mislead you about the language (e.g., many frameworks attempt to make JavaScript classy).</li>\n</ul>\n<br /><br /><p>Now, having said that, I do recommend exploring the vast diversity of frameworks and libraries out there after you&#8217;ve become comfortable with JavaScript.</p><br />\n<h2>Some Resource</h2><br />\n<ul><br /><li><p><a href=\"http://www.jshint.com/about/\">JSHint</a> a community-driven port of the aforementioned JSLint. It&#8217;s groovy. There&#8217;s an <a href=\"http://jslint4vs2010.codeplex.com/\">extension for Visual Studio 2010</a>. I also like to use it with the sublime <a href=\"http://www.sublimetext.com/download\">Sublime Text 2</a> by way of the the <a href=\"https://github.com/Kronuz/SublimeLinter\">SublimeLinter package</a>.</p></li>\n<li><p><a href=\"http://jsfiddle.net/\">jsfiddle</a> and <a href=\"http://jsbin.com\">jsbin</a> are two cool little online playgrounds for sharing bits of JavaScript.</p></li>\n<li><p><a href=\"http://nodejs.org/\">NodeJS</a> can be very good for playing around with JavaScript. Be careful though of trying to learn all about Node at the same time. Here&#8217;s a <a href=\"http://dev.bennage.com/blog/2011/07/28/node-js-on-windows/\">Windows-friendly quick start</a>.</p></li>\n</ul>\n<br /><br /><p>What else can you add?</p><img src=\"http://feeds.feedburner.com/~r/ChristopherBennage/~4/72mxw3vgX_Q\" height=\"1\" width=\"1\"/></p></div><div class=\"entry\"><div class=\"title\"><a href=\"http://feedproxy.google.com/~r/ChristopherBennage/~3/x_YzfAXqJ2c/\">Mobile Development: Detecting Devices & Features</a></div><div class=\"moreinfo\"><span class=\"date\">Wednesday, October 19, 2011</span> &nbsp;|&nbsp; <span class=\"source\">From <a target=\"_blank\" href=\"http://feeds.feedburner.com/ChristopherBennage\">Christopher Bennage</a></span></div><p><p><em>Take this post cum granlis salis. I&#8217;m trying to figure this stuff out and I&#8217;m thinking out loud.</em></p><br />\n<h2>Background</h2><br /><br /><p>Whenever a browser makes a request, it includes a string identifying itself to the server. We commonly refer to this as the <em>user agent string</em>. This string identifies the browser and the platform and the version and a great deal more such nonsense.</p><br /><br /><p><img class=\"right\" src=\"http://dev.bennage.com/images/posts/tower-babel.jpg\"></p><br /><br /><p>This sounds great in theory. We should be able to use this data to optimize what&#8217;s being sent to the (mobile) browser. However, there&#8217;s been something of a <a href=\"http://webaim.org/blog/user-agent-string-history/\" title=\"History of the browser user-agent string by Aaron Andersen\">sordid history for user agent strings</a>. In retrospect, we&#8217;ve realized that <a href=\"http://en.wikipedia.org/wiki/User_agent#User_agent_sniffing\">user agent sniffing</a> is a tool that has often hurt more than it has helped.</p><br /><br /><p>We&#8217;ve learned to <em>favor feature detection over browser detection</em> (or device detection). Take a look at <a href=\"http://www.modernizr.com/\">modernizr</a> and <a href=\"http://haz.io/\">haz.io</a> for more on the that front.  The success of feature detection has also resulted in a shift from server logic to client logic. We detect features on the client but we detect user agent strings on the server, before we send anything to the client.</p><br /><br /><p>How does all this play into the mobile web? One of the key mobile features we are interested in is <em>screen size</em>. Luckily for us, the W3C has blessed us with <a href=\"http://www.w3.org/TR/css3-mediaqueries/\">media queries</a>. In a nutshell, media queries allow you to conditionally apply CSS based properties of the display device. This has given rise to something known as <a href=\"http://www.alistapart.com/articles/responsive-web-design/\">Responsive Web Design</a>. Responsive Web Design is about having a single set of markup whose layout can <em>respond</em> to the device&#8217;s display capabilities. Unfortunately, there are a few <a href=\"http://www.webdesignshock.com/responsive-design-problems/\">rough edges</a> with this approach.</p><br />\n<h2>Moving Backwards</h2><br /><br /><p>In the mobile world, client-side feature detection has a few drawbacks. It requires extra code to be sent to the browsers and it takes additional processing on the client. It&#8217;s also likely that you&#8217;ll end up sending more than is really needed (or that you&#8217;ll need to make additional requests).</p><br /><br /><p>One solution to this conundrum is to use the open source &#8220;database&#8221; called <a href=\"http://wurfl.sourceforge.net/\">WURLF</a>. You can query WURL with a user agent string and it will return a set of capabilities. I think of it as <em>feature detection</em> on the server. Though admittedly it&#8217;s a bit misleading to call it that.</p><br /><br /><p>This means your server can ask questions like &#8220;Does this client support HTML5? If no, what do they support?&#8221; before the first response is even sent.</p><br /><br /><p>WURLF has <a href=\"http://scientiamobile.com/\">commercial support</a> and a <a href=\"http://wurfl.sourceforge.net/dotNet/\">C# API</a>. For ASP.NET developers, <a href=\"http://51degrees.mobi/\">51Degrees</a> has an open source project called <a href=\"http://51degrees.codeplex.com/\">Foundation</a> that is built on top of WURL. It uses an HttpModule to automatically query WURL and populate the <a href=\"http://msdn.microsoft.com/en-us/library/system.web.httprequest\">Request.Browser</a>. Setting up WURLF without Foundation takes a little bit more work, but not too much. Both are available on Nuget: <a href=\"http://www.nuget.org/List/Packages/WURFL_Official_API\">WURL</a> and <a href=\"http://nuget.org/List/Packages/51Degrees.mobi\">51Degrees</a>.</p><br />\n<h2>What should you do?</h2><br /><br /><p>I don&#8217;t think that there is a cut and dry answer <em>at the moment</em>. What you do depends heavily on your target audience. If you are targeting the <a href=\"http://gs.statcounter.com/#mobile_browser-na-monthly-201009-201109\">North American market</a> there&#8217;s a good chance you&#8217;ll be okay with a single set of markup, going with a responsive <a href=\"http://www.lukew.com/ff/entry.asp?933\">mobile-first</a> design. In other words, there would be no need for something like WURLF.</p><br /><br /><p>However, you might need a <em>very broad reach</em> or you might be targeting a market heavy in <a href=\"http://en.wikipedia.org/wiki/Feature_phone\">feature phones</a> or something else that&#8217;s <a href=\"http://gs.statcounter.com/#mobile_browser-sa-monthly-201009-201109\">very different from North America</a>. In those cases, it is good to understand your options.</p><img src=\"http://feeds.feedburner.com/~r/ChristopherBennage/~4/x_YzfAXqJ2c\" height=\"1\" width=\"1\"/></p></div><div class=\"entry\"><div class=\"title\"><a href=\"http://feedproxy.google.com/~r/ChristopherBennage/~3/Xz-4qAFU5iA/\">Blocks and Playsets</a></div><div class=\"moreinfo\"><span class=\"date\">Monday, October 17, 2011</span> &nbsp;|&nbsp; <span class=\"source\">From <a target=\"_blank\" href=\"http://feeds.feedburner.com/ChristopherBennage\">Christopher Bennage</a></span></div><p><p>I&#8217;ve recently discovered that I favor blocks over playsets. I&#8217;m talking about toys, and of course the canonical example of blocks is Legos. You can build nearly anything with them. They are useful, versatile, and inviting.</p><br /><br /><p>Now, the term &#8216;playset&#8217; warrants a bit more explanation. I don&#8217;t mean the large outdoor sets with swings and sandboxes and spring-loaded ponies. No, I&#8217;m a child of the 80s and I <em>loved me some</em> Star Wars playsets.</p><br /><br /><p><img class=\"right\" src=\"http://dev.bennage.com/images/posts/hoth-playset.jpg\"></p><br /><br /><p>So my definition of &#8216;playset&#8217; is colored by my childhood. I think think of &#8216;playset&#8217; as a themed toy representing an environment. Like the Hoth playset pictured here. If you want to pretend you are the Imperials raining destruction upon a ragtag Rebel Alliance, the <a href=\"http://www.ebay.com/csc/i.html?_nkw=Hoth+imperial+attack+playset&amp;LH_Complete=1&amp;_odkw=Hoth+attack+playset\" title=\"Yes, I had this as a kid.\">Hoth Imperial Attack playset</a> can&#8217;t be beat.</p><br /><br /><p>The problem is <em>that&#8217;s all you can do with it</em>. I mean, you can&#8217;t use the Hoth playset to stage an epic Cybertronian showdown between Optimus and Megatron. (Well you can, but you&#8217;ll have admit it&#8217;s just a bit awkward.)</p><br /><br /><p>Let&#8217;s get back to the blocks. Those puppies can be used to reconstruct a carbonite freezing chamber <em>as well as</em> hosting a dramatic cliff-side battle between Snake Eyes and Storm Shadow. Better yet, you can construct worlds of your own invention instead of merely mirroring those of others.</p><br /><br /><p>In reality, it&#8217;s not so cut and dry. (Nothing is, is it?) No, in reality, there&#8217;s a spectrum. In reality, there is Lego  Star Wars. The line between blocks and playsets is blurred.</p><br />\n<h2>Software</h2><br /><br /><p>I believe these categories apply to software as well, though we call them <em>libraries</em> and <em>frameworks</em>. <a href=\"http://wekeroad.com/\">Rob Conery</a> asked a <a href=\"https://plus.google.com/u/0/100497775264295816553/posts/DoWuYVrDzqX%20%22Is%20Backbone.js%20is%20a%20Framework%20or%20a%20Library?\">question about this</a> on Google+ recently. <a href=\"http://lostechies.com/derickbailey/\">Derick Bailey</a> provides a definition attributed to Chris Eppstein:</p><br /><br /><blockquote><p>&#8220;Frameworks call your code, you call library code.&#8221;</p></blockquote>\n<br /><br /><p>I began thinking about this from a different angle. I think that <em>frameworks impose an opinion</em>. <a href=\"http://rubyonrails.org/\">Ruby on Rails</a> has a <a href=\"http://gettingreal.37signals.com/ch04_Make_Opinionated_Software.php\">strong opinion</a> about how to create web apps. I think that make it a framework. Or at least, closer to the framework end of the spectrum than to the library end.</p><br /><br /><p><img class=\"right\" src=\"http://dev.bennage.com/images/posts/crossover-comic.jpg\"></p><br /><br /><p>Now, to be clear, I am <em>not</em> saying that opinionated software or that frameworks are bad. In fact, they can be brilliant. I think Rail&#8217;s strong opinion has been a significant contribution to its success. What&#8217;s important to understand though is the limitations. When you are using a framework, the boundaries are harder to cross. The results can be strained and unnatural. The problem for me begins when our fanboy favor for a framework leads us to force its use it where it doesn&#8217;t fit.</p><br />\n<h2>Fun</h2><br /><br /><p>Playing with both blocks and playsets is <em>fun</em>. So let&#8217;s stretch the analogy even further. What does that mean to software development? My takeaway is this:</p><br />\n<ul><br /><li>Understand the tools you are using.</li>\n<li>If it hurts, ask why. (I always liked Ayende&#8217;s <a href=\"http://ayende.com/blog/3320/zero-friction-maintainability\">Zero Friction thoughts</a>.)</li>\n<li>Finally, <a href=\"http://hanselminutes.com/260/net-api-design-that-optimizes-for-programmer-joy-with-jonathan-carter\">optimize your development experience for joy</a>.</li>\n</ul><img src=\"http://feeds.feedburner.com/~r/ChristopherBennage/~4/Xz-4qAFU5iA\" height=\"1\" width=\"1\"/></p></div><div class=\"entry\"><div class=\"title\"><a href=\"http://feedproxy.google.com/~r/ChristopherBennage/~3/gFmAGfAthDI/\">Being a New Kid on the Mobile Block</a></div><div class=\"moreinfo\"><span class=\"date\">Monday, October 10, 2011</span> &nbsp;|&nbsp; <span class=\"source\">From <a target=\"_blank\" href=\"http://feeds.feedburner.com/ChristopherBennage\">Christopher Bennage</a></span></div><p><p>The last few weeks I&#8217;ve been trying get a finger on the pulse of <em>mobile web development</em>. I wanted to identify the thought leaders, understand the big questions, and (perhaps mostly importantly) begin cataloging the practical considerations for building mobile experiences today.</p><br /><br /><p>Here&#8217;s where I&#8217;m at so far&#8230;</p><br /><br /><! more ><br /><br />\n<h2>What is &#8216;the mobile web&#8217;?</h2><br /><br /><p><span class=has-pullquote data-pullquote=I think the distinction between mobile and desktop is fading more and more everyday.><br />The definition of <em>mobile web</em> is quickly evolving. Devices are varied and the distinctions are blurring. If you think it&#8217;s as simple as iOS, Android, <em>and Windows</em> then you&#8217;ll be surprised. (I do genuinely love my WP7). Personally, I think the distinction between mobile and desktop is fading more and more everyday. When I say <em>mobile web</em> I am talking about HTML-based applications and not applications that are built natively for their respective platforms. Of course, there is debate over native apps versus web apps: when is one appropriate over the over? etc, etc. This is a question when intend to address in <a href=\"http://liike.github.com/\">Project Liike</a>.<br /></span></p><br />\n<h2>Who to follow?</h2><br /><br /><p>I&#8217;ve been following a mishmash of people, and I must confess that my process of qualifying them has been some haphazard.<br />I&#8217;m compiling a <a href=\"http://twitter.com/#!/bennage/mobile-web\" title=\"membership subject to change\">list on twitter</a>. A number of folks on this list are signatories of <a href=\"http://futurefriend.ly/\" title=\"advocates of standards based mobile web development\">future friend.ly</a>.</p><br /><br /><p>Other sources I&#8217;ve been paying attention to are:</p><br />\n<ul><br /><li><a href=\"http://www.alistapart.com/\">A List Apart</a>  &#8220;For people who make websites.&#8221;</li>\n<li><a href=\"http://www.smashingmagazine.com/\">Smashing Magainze</a>  Lots of articles on design, web, and of course mobile.</li>\n<li><a href=\"http://www.cloudfour.com/blog/\">Cloud Four</a>  Many recent and thorough posts exploring some of the big questions in mobile.</li>\n<li><a href=\"http://www.yiibu.com/\">Yiibu</a>  They have a lot of interesting ideas, and they&#8217;ve done some <a href=\"http://www.yiibu.com/articles/practical-guide-to-nokia-browsers/\">impressive work</a> for Nokia.</li>\n</ul>\n<br /><br /><p>I&#8217;ve also been reading through <a href=\"http://shop.oreilly.com/product/9780596807795.do\"><em>Programming the Mobile Web</em></a> by <a href=\"http://twitter.com/#!/firt\">Maximiliano Firtman</a>. The first few chapters are pretty scary for someone like myself who did not understand how diverse and scattered the mobile world is. (It&#8217;s also funny to see how much has changed since the book was published in 2010.)</p><br /><br /><p>Anything you&#8217;d recommend?</p><br />\n<h2>The state of things</h2><br /><br /><p><em>Caveat</em>: <em>This is just Christopher&#8217;s brain dump. Consider it merely food for thought.</em></p><br />\n<ul><br /><li>There are many <a href=\"http://techcrunch.com/2011/02/09/html5-versus-native-apps/\">compeling</a> <a href=\"http://www.html5rocks.com/en/mobile/nativedebate.html\">reasons</a> for developing mobile web apps. Not to the complete exclusion of <a href=\"http://www.webmonkey.com/2010/08/how-do-native-apps-and-web-apps-compare/\">native apps</a>, but <a href=\"http://www.phonegap.com/\">maybe?</a></li>\n<li>You need to understand your target market and the devices that it uses. Don&#8217;t make assumptions. You might be <a href=\"http://gs.statcounter.com/#mobile_os-ww-monthly-201009-201109\">surprised</a>.</li>\n<li>The space is changing, standards are evolving, solutions are being formulated. However, if you need to you need build an app today, there is still plently of <a href=\"http://www.w3.org/TR/mobile-bp/\" title=\"Yes, its a little old but still mostly good.\">pragmatic</a> <a href=\"http://mobilewebbestpractices.com/\">advice</a>.</li>\n</ul>\n<br /><br /><p>One more thought: don&#8217;t jump to conclusions. You might read about something cool like <a href=\"http://www.alistapart.com/articles/responsive-web-design/\"><em>Responsive Web Design</em></a>, but such cool and innovative techniques can be <a href=\"http://www.cloudfour.com/css-media-query-for-mobile-is-fools-gold/\" title=\"CSS Media Query for Mobile is Fools Gold\">deceptive</a>. Research and testing is your friend.</p><img src=\"http://feeds.feedburner.com/~r/ChristopherBennage/~4/gFmAGfAthDI\" height=\"1\" width=\"1\"/></p></div><div class=\"accentbar\"><span class=\"left\">&nbsp;</span>Christopher Bennage News Feed<span class=\"right\">&nbsp;</span></div></div></div><div class=\"ClearBoth\"></div>",
  "TagList": "WPF,patterns,design patterns,UI,UI Testing,architecture,TDD,GUI,Guidance,pattern,caliburn,MVVM,viewmodel,Presentation Model,WPF Architectures,",
  "LastEdited": "2009-06-10T14:21:09.393-07:00"
}