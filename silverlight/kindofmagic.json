{
  "ProjectName": "kindofmagic",
  "Title": "Kind Of Magic MSBuild Task",
  "Description": "MSBuild task to simplify implementation of INotifyPropertyChanged interface for WinRT, Silverlight 2.0+, .NET 2.0+, Windows Phone 7+, Portable Class Libraries.",
  "MovedLink": "",
  "HomeWiki": "<div class=\"wikidoc\"><b>Project Description</b><br /><br /><b>26.06.2015 Project moved to <u><a href=\"http://github.com/demigor/kindofmagic\">github</a></u>! Please update your bookmarks.</b><br /><br />MSBuild task to simplify implementation of INotifyPropertyChanged interface for WinRT, Silverlight 2.0&#43;, .NET 2.0&#43;, Windows Phone 7&#43;, Portable Class Libraries.<br /><br /><u><a href=\"http://nuget.org/packages/KindOfMagic\">25.12.2012 NuGet Package KindOfMagic Released!</a></u><br /><br />During compile time it injects supporting code in property setters: raising PropertyChanged event when value changed. <br /><br />In comparison to similar projects, KindOfMagic:<br />\n<ul><li>provides developer with the best control what properties and classes get transformed.</li>\n<li>injects no complex heuristics which could make your application behave weird. </li>\n<li>is easy to use and understand.</li>\n<li>does only what is indeed expected and needed from developer. </li>\n<li>can be used in build environments.</li>\n<li>has VS.NET Addin to one-click enabled/disable MSBuild task for your C# projects</li>\n<li>needs only 2 Attributes to control its logic, which developer can define in own code.</li>\n<li>needs no extra references.</li>\n<li>can be used with and without your base class.</li>\n<li>has fire-and-forget mode - with base class developer can apply attributes only once and all derived classes (including those from another assemblies) will get transformed.</li>\n<li>supports WinRT C# Metro Apps, Silverlight as well as .NET FX (client and extended profiles)</li></ul>\n<br />Fastest way to get in touch: <a href=\"http://twitter.com/demigor\">http://twitter.com/demigor</a><br /><br /><b>What is it?</b><br />Take a look at this painfully familar code:<br /><br /><div style=\"color:Black;background-color:White;\"><pre>\r\n<span style=\"color:Blue;\">public</span> <span style=\"color:Blue;\">string</span> Name \n{\n  <span style=\"color:Blue;\">get</span> \n  { \n    <span style=\"color:Blue;\">return</span> _name; \n  }\n  <span style=\"color:Blue;\">set</span> \n  { \n    <span style=\"color:Blue;\">if</span> (_name != value)\n    {\n      _name = value;\n      RaisePropertyChanged(<span style=\"color:#A31515;\">&quot;Name&quot;</span>);\n    }\n  }\n} \r\n</pre></div>and now imagine, that you just need to write only this:<br /><br /><div style=\"color:Black;background-color:White;\"><pre>\r\n[Magic]\n<span style=\"color:Blue;\">public</span> <span style=\"color:Blue;\">string</span> Name { <span style=\"color:Blue;\">get</span>; <span style=\"color:Blue;\">set</span>; }\r\n</pre></div>If you need your private field, you may also write like this:<br /><br /><div style=\"color:Black;background-color:White;\"><pre>\r\n[Magic]\n<span style=\"color:Blue;\">public</span> <span style=\"color:Blue;\">string</span> Name { <span style=\"color:Blue;\">get</span> { <span style=\"color:Blue;\">return</span> _name; } <span style=\"color:Blue;\">set</span> { _name = value; } }\n<span style=\"color:Blue;\">string</span> _name;\r\n</pre></div>Or you may apply Magic attribute to a class, and all public properties (including all derived classes) will be transformed.<br /><br /><div style=\"color:Black;background-color:White;\"><pre>\r\n[Magic]\n<span style=\"color:Blue;\">public</span> <span style=\"color:Blue;\">class</span> MyViewModel: INotifyPropertyChanged\n{\n  <span style=\"color:Blue;\">public</span> <span style=\"color:Blue;\">string</span> Name { <span style=\"color:Blue;\">get</span>; <span style=\"color:Blue;\">set</span>; }\n  <span style=\"color:Blue;\">public</span> <span style=\"color:Blue;\">string</span> LastName { <span style=\"color:Blue;\">get</span>; <span style=\"color:Blue;\">set</span>; }\n  .....\n  <span style=\"color:Blue;\">#region</span> Implementation of INotifyPropertyChanged\n  .... <span style=\"color:Green;\">// Your custom implementation required</span>\n  <span style=\"color:Blue;\">#endregion</span>\n}\r\n</pre></div>To disable transformation, apply NoMagic attribute to a class or property:<br /><br /><div style=\"color:Black;background-color:White;\"><pre>\r\n[NoMagic] <span style=\"color:Green;\">// explicit stop of implicit property transformation</span>\n<span style=\"color:Blue;\">public</span> <span style=\"color:Blue;\">class</span> MyExplicitViewModel: MyViewModel\n{\n  <span style=\"color:Blue;\">public</span> <span style=\"color:Blue;\">long</span> Age { <span style=\"color:Blue;\">get</span>; <span style=\"color:Blue;\">set</span>; } <span style=\"color:Green;\">// will not be transformed implicitly</span>\n  [Magic] <span style=\"color:Green;\">// explicit transformation</span>\n  <span style=\"color:Blue;\">public</span> <span style=\"color:Blue;\">string</span> FirstName { <span style=\"color:Blue;\">get</span>; <span style=\"color:Blue;\">set</span>; }\n  .....\n}\r\n</pre></div><br />That&#39;s exacly what Kind Of Magic does! No more, no less.<br /><br /><b>How to use?</b><br />1) Define somewhere in your project MagicAttribute and NoMagicAttribute (optional) class, derived from Attribute. Neither visibility nor namespace are relevant. Here is an example, just two lines of code:<br /><div style=\"color:Black;background-color:White;\"><pre>\r\n<span style=\"color:Blue;\">class</span> MagicAttribute: Attribute { }\n<span style=\"color:Blue;\">class</span> NoMagicAttribute: Attribute { }\r\n</pre></div>2) Apply Magic attribute to public properties in your ViewModel classes, implementing INotifyPropertyChanged. Your class must have accessible void RaisePropertyChanged(string) method. <br />3) Apply Magic attribute to ViewModel class if you want all public properties to raise PropertyChanged event. To exclude some of them, apply NoMagic attribute to these properties.<br /><br /><b>How it works</b><br />1) KindOfMagic build task runs just after compilation.<br />2) Looks for both MagicAttribute and NoMagicAttribute in building assembly and all referenced user assemblies.<br />3) Only classes, implementing INotifyPropertyChanged, and their descendants are inspected.<br />4) Looks for void RaisePropertyChanged(string) method.<br />5) Transforms all available setters of public properties with MagicAttribute explicitly or implicitly applied.<br />6) Injects supporting code using Mono.Cecil. Corresponding PDB file is also updated if any. Assembly will be resigned if signing is turned on. Use Reflector to see, what KindOfMagic does for you.<br /><br /><b>Installation type 1: NuGet Package Manager</b><br />In Package Manager Console enter the following command:<br /><pre>Install-Package KindOfMagic</pre><b>Installation type 2: VS2010/2012 Extension</b><br />a) Download VS Package from download area. <br />b) Double-click and install it into VS.NET 2010/11. <br />c) In menu Project you&#39;ll find Enable/Disable Kind Of Magic menu items to enable/disable it for selected projects.<br /><br /><b>Installation type 3: Build Server/Manual</b><br />a) Download Binaries from download area. <br />b) Make somewhere folder KindOfMagic and extract content of the binary archive. <br />c) Remember the path to KindOfMagic.exe (f.e. z:\\KindOfMagic\\KindOfMagic.targets)<br /><br />1) Per-Project<br />  a) Insert following Xml snippet somewhere inside your Project element in your csproj-file and adjust path to KindOfMagic.targets.<br /><div style=\"color:Black;background-color:White;\"><pre>\r\n<span style=\"color:Blue;\">&lt;</span><span style=\"color:#A31515;\">Import</span> <span style=\"color:Red;\">Project</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">z:\\KindOfMagic\\KindOfMagic.targets</span><span style=\"color:Black;\">&quot;</span> <span style=\"color:Blue;\">/&gt;</span>\r\n</pre></div>2) Global <br /> a) Locate Microsoft.CSharp.targets for .NET framework 4<br /> b) Insert the same line:<br /><br /><div style=\"color:Black;background-color:White;\"><pre>\r\n<span style=\"color:Blue;\">&lt;</span><span style=\"color:#A31515;\">Import</span> <span style=\"color:Red;\">Project</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">z:\\KindOfMagic\\KindOfMagic.targets</span><span style=\"color:Black;\">&quot;</span> <span style=\"color:Blue;\">/&gt;</span>\r\n</pre></div> <br /><br /><b>Customization</b><br />If for some reason you don&#39;t like magic, here are some customization hints for you. You may parameterise names of Magic, NoMagic and RaisePropertyChanged identifiers.<br /><br />In KindOfMagic.targets file, locate MagicTask xml element and add following attributes:<br /><div style=\"color:Black;background-color:White;\"><pre>\r\n<span style=\"color:Blue;\">&lt;</span><span style=\"color:#A31515;\">MagicTask</span> <span style=\"color:Red;\">....</span>  <span style=\"color:Red;\">MagicAttribute</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">NotifyAttribute</span><span style=\"color:Black;\">&quot;</span> <span style=\"color:Red;\">NoMagicAttribute</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">StopNotifyAttribute</span><span style=\"color:Black;\">&quot;</span> <span style=\"color:Red;\">RaiseMethod</span><span style=\"color:Blue;\">=</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">OnPropertyChanged</span><span style=\"color:Black;\">&quot;</span><span style=\"color:Blue;\">/&gt;</span>\r\n</pre></div>This will use Notify/StopNotify instead of Magic/NoMagic attributes and OnPropertyChanged instead of RaisePropertyChanged method during transformation.<br /><br /><b>Beacon method call</b><br />Sometimes, when property setter code is relative complex, you may see this warning produced by KindOfMagic:<br /><br /><span class=\"codeInline\"> Property MyViewModel.MyProperty setter is too complex. Use beacon method (static void Raise()) to indicate point of RaisePropertyChanged injection. </span><br /><br />Usually, this could be seen in setters like this:<br /><div style=\"color:Black;background-color:White;\"><pre>\r\n<span style=\"color:Blue;\">public</span> <span style=\"color:Blue;\">object</span> MyProperty \n{\n  <span style=\"color:Blue;\">get</span> { <span style=\"color:Blue;\">return</span> _field; }\n  <span style=\"color:Blue;\">set</span> \n  {\n     _field = value;\n\n     <span style=\"color:Blue;\">if</span> (value != <span style=\"color:Blue;\">null</span>)\n       DoSomething();\n  }\n}\r\n</pre></div>This happens because in IL, produced by C# compiler, it is not more possible to distinguish normal return (with keyword return) from conditional return. In this case, KindOfMagic redirects all returns to injected RaisePropertyChanged section of the setter, so all returns will raise property changed event. This gives you, as a programer, less control over your code. To solve this issue, I came up with the Beacon method idea.<br /><br />Define somewhere a static void method Raise without any parameters. Here is an example:<br /><br /><div style=\"color:Black;background-color:White;\"><pre>\r\n<span style=\"color:Blue;\">public</span> <span style=\"color:Blue;\">class</span> MyViewModel : INotifyPropertyChanged\n{\n  ...\n  [MethodImpl(MethodImplOptions.NoInlining)] <span style=\"color:Green;\">// to preserve method call </span>\n  <span style=\"color:Blue;\">protected</span> <span style=\"color:Blue;\">static</span> <span style=\"color:Blue;\">void</span> Raise() { }\n}\r\n</pre></div>In every problematic setter, place a call to this method just before the last curly brace of your setter. Here is an example:<br /><br /><div style=\"color:Black;background-color:White;\"><pre>\r\n<span style=\"color:Blue;\">public</span> <span style=\"color:Blue;\">object</span> MyProperty \n{\n  <span style=\"color:Blue;\">get</span> { <span style=\"color:Blue;\">return</span> _field; }\n  <span style=\"color:Blue;\">set</span> \n  {\n     _field = value;\n\n     <span style=\"color:Blue;\">if</span> (value != <span style=\"color:Blue;\">null</span>)\n       DoSomething();\n\n     Raise();\n  }\n}\r\n</pre></div>KindOfMagic will automagically replace Raise method call with RaisePropertyChanged section instead. No return statement will be remapped and no warning message will be emitted.<br /><br /><b>Notes</b><br />To improve KindOfMagic performance, all types with namespace name started with &#39;System.&#39; are considered core types and not processed. </div><div class=\"ClearBoth\"></div>",
  "TagList": "",
  "LastEdited": "2015-06-26T14:14:42.333-07:00"
}