{
  "ProjectName": "WCFDuplexAZURE",
  "Title": "WCF Duplex Service on Azure using a Silverlight Client",
  "Description": "I had some trouble to build correctly a simple WCF Duplex Service that run on Windows AZURE while the Connection is made anonymously, after a lot of research I decided to share my solution",
  "MovedLink": "",
  "HomeWiki": "<div class=\"wikidoc\">\r\n<p><span style=\"text-decoration:underline\"><strong>Creating a WCF Duplex Service on Azure with a Silverlight Client</strong></span></p>\r\n<p>I had some trouble to build correctly a simple WCF Duplex Service that run on Windows AZURE while the Connection is made anonymously, after a lot of research I decided to share my solution<br>\r\nso basicaly the solution is quite simple,</p>\r\n<p>the only thing you have to remember is:</p>\r\n<ol>\r\n<li>your client is a Silverlight one so you have some limitation about you'r Binding Protocol\r\n</li><li>your Server is on an Azure PLatform so lets try to use what Azure can Offer to us\r\n</li><li>we need a Duplex Service so not all the Bindings can fit </li><li>We wan to do that without using any authentication to forget about WSHttpBinding or simillar Protocols\r\n</li></ol>\r\n<p>&nbsp;</p>\r\n<hr>\r\n<p>&nbsp;</p>\r\n<p>In order to do that i decided to use a Custom Binding made by Microsoft. You will be able to find this custom Binding in the Microsoft SDK Folder( Program Files =&gt; Microsoft SDKs) &nbsp;in the Silverlight Folder, Choose your Version(i'm using 4.0),under\r\n Library Folder you will find the System.ServiceModel.PollingDuplex.dll for your Client and your Service. after i added those DLLs to my Solution, i have to setup my config file:</p>\r\n<p><span style=\"color:#800000\"><strong><span style=\"text-decoration:underline\">Server</span></strong></span></p>\r\n<p>For the Server i have a simple WCFWorker Role:<br>\r\nin the Config file of our service we have to add the dll to the config file:</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre><span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">extensions</span><span style=\"color:blue\">&gt;</span>\n      <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">bindingExtensions</span><span style=\"color:blue\">&gt;</span>\n        <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">add</span> <span style=\"color:red\">name</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">pollingDuplexHttpBinding</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">type</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">System.ServiceModel.Configuration.PollingDuplexHttpBindingCollectionElement, System.ServiceModel.PollingDuplex, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35</span><span style=\"color:black\">&quot;</span> <span style=\"color:blue\">/&gt;</span>\n      <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">bindingExtensions</span><span style=\"color:blue\">&gt;</span>\n    <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">extensions</span><span style=\"color:blue\">&gt;</span>\n</pre>\r\n</div>\r\n<p><br>\r\n<span style=\"text-decoration:underline\">Binding:</span></p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre><span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">bindings</span><span style=\"color:blue\">&gt;</span>\n      <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">pollingDuplexHttpBinding</span><span style=\"color:blue\">&gt;</span>\n        <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">binding</span> <span style=\"color:red\">name</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">PubSub</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">duplexMode</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">MultipleMessagesPerPoll</span><span style=\"color:black\">&quot;</span> <span style=\"color:blue\">/&gt;</span><span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">pollingDuplexHttpBinding</span><span style=\"color:blue\">&gt;</span>    \n<span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">bindings</span><span style=\"color:blue\">&gt;</span>\n</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p><span style=\"text-decoration:underline\">Behavior:</span></p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre><span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">behaviors</span><span style=\"color:blue\">&gt;</span>\n      <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">serviceBehaviors</span><span style=\"color:blue\">&gt;</span>\n        <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">behavior</span> <span style=\"color:red\">name</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">PubSubServiceBehavior</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">&gt;</span>\n          <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">serviceMetadata</span> <span style=\"color:red\">httpGetEnabled</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">true</span><span style=\"color:black\">&quot;</span> <span style=\"color:blue\">/&gt;</span>\n          <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">serviceDebug</span> <span style=\"color:red\">includeExceptionDetailInFaults</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">true</span><span style=\"color:black\">&quot;</span> <span style=\"color:blue\">/&gt;</span>\n          <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">serviceThrottling</span> <span style=\"color:red\">maxConcurrentSessions</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">2147483647</span><span style=\"color:black\">&quot;</span> <span style=\"color:blue\">/&gt;</span>\n        <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">behavior</span><span style=\"color:blue\">&gt;</span>\n      <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">serviceBehaviors</span><span style=\"color:blue\">&gt;</span>\n    <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">behaviors</span><span style=\"color:blue\">&gt;</span>\n</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p><span style=\"text-decoration:underline\">Service:</span><br>\r\n<br>\r\n<br>\r\n</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre>  <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">system.serviceModel</span><span style=\"color:blue\">&gt;</span>\n    <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">extensions</span><span style=\"color:blue\">&gt;</span>\n      <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">bindingExtensions</span><span style=\"color:blue\">&gt;</span>\n        <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">add</span> <span style=\"color:red\">name</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">pollingDuplexHttpBinding</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">type</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">System.ServiceModel.Configuration.PollingDuplexHttpBindingCollectionElement, System.ServiceModel.PollingDuplex, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35</span><span style=\"color:black\">&quot;</span> <span style=\"color:blue\">/&gt;</span>\n      <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">bindingExtensions</span><span style=\"color:blue\">&gt;</span>\n    <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">extensions</span><span style=\"color:blue\">&gt;</span>\n    <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">bindings</span><span style=\"color:blue\">&gt;</span>\n      <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">pollingDuplexHttpBinding</span><span style=\"color:blue\">&gt;</span>\n        <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">binding</span> <span style=\"color:red\">name</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">PubSub</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">duplexMode</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">MultipleMessagesPerPoll</span><span style=\"color:black\">&quot;</span> <span style=\"color:blue\">/&gt;</span>\n      <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">pollingDuplexHttpBinding</span><span style=\"color:blue\">&gt;</span>\n    <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">bindings</span><span style=\"color:blue\">&gt;</span>\n    <span style=\"color:green\">&lt;!-- Ensure this setting is present for WCF to pick up base addresses correctly in Azure. --&gt;</span>\n    <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">serviceHostingEnvironment</span> <span style=\"color:red\">multipleSiteBindingsEnabled</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">true</span><span style=\"color:black\">&quot;</span> <span style=\"color:blue\">/&gt;</span>\n    <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">behaviors</span><span style=\"color:blue\">&gt;</span>\n      <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">serviceBehaviors</span><span style=\"color:blue\">&gt;</span>\n        <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">behavior</span> <span style=\"color:red\">name</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">PubSubServiceBehavior</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">&gt;</span>\n          <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">serviceMetadata</span> <span style=\"color:red\">httpGetEnabled</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">true</span><span style=\"color:black\">&quot;</span> <span style=\"color:blue\">/&gt;</span>\n          <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">serviceDebug</span> <span style=\"color:red\">includeExceptionDetailInFaults</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">true</span><span style=\"color:black\">&quot;</span> <span style=\"color:blue\">/&gt;</span>\n          <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">serviceThrottling</span> <span style=\"color:red\">maxConcurrentSessions</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">2147483647</span><span style=\"color:black\">&quot;</span> <span style=\"color:blue\">/&gt;</span>\n        <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">behavior</span><span style=\"color:blue\">&gt;</span>\n      <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">serviceBehaviors</span><span style=\"color:blue\">&gt;</span>\n    <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">behaviors</span><span style=\"color:blue\">&gt;</span>\n    <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">services</span><span style=\"color:blue\">&gt;</span>\n      <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">service</span> <span style=\"color:red\">behaviorConfiguration</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">PubSubServiceBehavior</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">name</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">WCFServiceWebRole2.Service1</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">&gt;</span>\n        <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">endpoint</span> <span style=\"color:red\">address</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">&quot; binding=&quot;pollingDuplexHttpBinding</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">bindingConfiguration</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">PubSub</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">contract</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">WCFServiceWebRole2.IService1</span><span style=\"color:black\">&quot;</span> <span style=\"color:blue\">/&gt;</span>\n        <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">endpoint</span> <span style=\"color:red\">address</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">mex</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">binding</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">mexHttpBinding</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">contract</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">IMetadataExchange</span><span style=\"color:black\">&quot;</span> <span style=\"color:blue\">/&gt;</span>\n      <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">service</span><span style=\"color:blue\">&gt;</span>\n    <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">services</span><span style=\"color:blue\">&gt;</span>\n  <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">system.serviceModel</span><span style=\"color:blue\">&gt;</span>\n</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p>In our Code we don't need anything Special, just our regular configuration,</p>\r\n<p><span style=\"text-decoration:underline\">for example:</span></p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre>[ServiceContract(CallbackContract = <span style=\"color:blue\">typeof</span>(IServiceCallBack))]\n    <span style=\"color:blue\">public</span> <span style=\"color:blue\">interface</span> IService1\n    {\n        [OperationContract(IsOneWay = <span style=\"color:blue\">true</span>)]\n        <span style=\"color:blue\">void</span> GetData(<span style=\"color:blue\">int</span> value);\n    }\n\n    [ServiceContract]\n    <span style=\"color:blue\">public</span> <span style=\"color:blue\">interface</span> IServiceCallBack\n    {\n        [OperationContract(IsOneWay = <span style=\"color:blue\">true</span>)]\n        <span style=\"color:blue\">void</span> MessageReceived(<span style=\"color:blue\">string</span> message);\n    }\n</pre>\r\n</div>\r\n<p>&nbsp;</p>\r\n<p>and just For the Example i have a simple Implementation:</p>\r\n<p>&nbsp;</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre>[ServiceBehavior(ConcurrencyMode = ConcurrencyMode.Multiple, InstanceContextMode = InstanceContextMode.Single)]\n    <span style=\"color:blue\">public</span> <span style=\"color:blue\">class</span> Service1 : IService1\n    {\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">void</span> GetData(<span style=\"color:blue\">int</span> value)\n        {\n            callbackmanager CM = <span style=\"color:blue\">new</span> callbackmanager(Callback, value &#43; <span style=\"color:#a31515\">&quot; - &quot;</span> &#43; OperationContext.Current.SessionId);\n            Task.Factory.StartNew(CM.SendMssg);\n        }\n        IServiceCallBack Callback\n        {\n            <span style=\"color:blue\">get</span>\n            {\n                <span style=\"color:blue\">return</span> OperationContext.Current.GetCallbackChannel&lt;IServiceCallBack&gt;();\n            }\n        }\n    }\n    <span style=\"color:blue\">public</span> <span style=\"color:blue\">class</span> callbackmanager\n    {\n        IServiceCallBack _callback;\n        <span style=\"color:blue\">string</span> UserMessage;\n        <span style=\"color:blue\">public</span> callbackmanager(IServiceCallBack callback, <span style=\"color:blue\">string</span> usermsg)\n        {\n            _callback = callback;\n            UserMessage = usermsg;\n        }\n        <span style=\"color:blue\">public</span> <span style=\"color:blue\">void</span> SendMssg()\n        {\n            Thread.Sleep(5000);\n            _callback.MessageReceived(UserMessage);\n        }\n    }\n</pre>\r\n</div>\r\n<p><br>\r\n<br>\r\n<span style=\"text-decoration:underline\"><strong>Client:</strong></span><br>\r\n<br>\r\nFor our Client we have to remember to add our Dll also situated at :C:\\Program Files\\Microsoft SDKs\\Silverlight\\v4.0\\Libraries\\Client\\System.ServiceModel.PollingDuplex.dll<br>\r\n<br>\r\nnow just Search for the Service you just published, you will see the Service reference add automaticaly and that's it you'r good to go :)<br>\r\nIn case that in the ServiceReference client config there is nothing about this new service,<br>\r\nyou can add by yourself the configuration like that:<br>\r\n<br>\r\n</p>\r\n<div style=\"color:black; background-color:white\">\r\n<pre><span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">system.serviceModel</span><span style=\"color:blue\">&gt;</span>\n    <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">bindings</span><span style=\"color:blue\">&gt;</span>\n      <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">customBinding</span><span style=\"color:blue\">&gt;</span>\n        <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">binding</span> <span style=\"color:red\">name</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">CustomBinding_IPubSub</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">&gt;</span>\n          <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">pollingDuplex</span> <span style=\"color:red\">duplexMode</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">MultipleMessagesPerPoll</span><span style=\"color:black\">&quot;</span> <span style=\"color:blue\">/&gt;</span>\n          <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">binaryMessageEncoding</span> <span style=\"color:blue\">/&gt;</span>\n          <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">httpTransport</span> <span style=\"color:red\">maxReceivedMessageSize</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">2147483647</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">maxBufferSize</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">2147483647</span><span style=\"color:black\">&quot;</span>\n                         <span style=\"color:red\">transferMode</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">StreamedResponse</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">/&gt;</span>\n        <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">binding</span><span style=\"color:blue\">&gt;</span>\n      <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">customBinding</span><span style=\"color:blue\">&gt;</span>\n    <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">bindings</span><span style=\"color:blue\">&gt;</span>\n    <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">client</span><span style=\"color:blue\">&gt;</span>\n      <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">endpoint</span> <span style=\"color:red\">address</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">http://127.0.0.1:8080/InsightService.svc</span><span style=\"color:black\">&quot;</span>\n       <span style=\"color:red\">binding</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">customBinding</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">bindingConfiguration</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">CustomBinding_IPubSub</span><span style=\"color:black\">&quot;</span>\n       <span style=\"color:red\">contract</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">ServiceReference2.IDataService</span><span style=\"color:black\">&quot;</span> <span style=\"color:red\">name</span><span style=\"color:blue\">=</span><span style=\"color:black\">&quot;</span><span style=\"color:blue\">CustomBinding_IPubSub</span><span style=\"color:black\">&quot;</span> <span style=\"color:blue\">/&gt;</span>\n    <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">client</span><span style=\"color:blue\">&gt;</span>\n    <span style=\"color:blue\">&lt;</span><span style=\"color:#a31515\">extensions</span> <span style=\"color:blue\">/&gt;</span>\n  <span style=\"color:blue\">&lt;/</span><span style=\"color:#a31515\">system.serviceModel</span><span style=\"color:blue\">&gt;</span>\n</pre>\r\n</div>\r\n<p><br>\r\n<br>\r\nbut if you have to update your service reference you will have to delete this configuration from your file and add it again manuallyhope that helped you :0)</p>\r\n<p>Jeremy Souffir</p>\r\n</div><div class=\"ClearBoth\"></div>",
  "TagList": "",
  "LastEdited": "2012-04-05T01:30:03.8-07:00"
}